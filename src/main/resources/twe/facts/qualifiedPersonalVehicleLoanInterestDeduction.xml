<?xml version="1.0"?>
<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <!--        Interest paid on loan during taxable year-->
    <Fact path="/personalVehicleLoanInterestAmount">
      <Name>Interest paid on passenger vehicle loan</Name>
      <Description>How much interest have you paid on the passenger vehicle loan during the tax
        year?
      </Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <!--        Eligibility and calculations-->
    <Fact path="/isEligibleForQualifiedPassengerVehicleLoanInterestDeduction">
      <Name>Eligible for Qualified Passenger Vehicle Loan Interest Deduction</Name>
      <Description>Taxpayer eligibility for</Description>
      <Derived>
        <!--We plan to handle eligibilty through content. Previous iterations used fact-based eligibility with ~a dozen writable booleans to ensure that the vehicle and loan met the legal requirements-->
        <GreaterThan>
          <Left>
            <Dependency path="/personalVehicleLoanInterestAmount"/>
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>
    <Fact path="/maxQPVLIDAmount">
      <Name>Maximum qualified personal vehicle loan deduction</Name>
      <Description>The maximum amount one is allowed to deduct because of qualified personal vehicle
        loan interest
        payments
      </Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>10000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/excessAmountQPVLIDForMFJFiler">
      <Derived>
        <GreaterOf>
          <Subtract>
            <Minuend>
              <Dependency path="/magiForOB3BelowLineDeductions"/>
            </Minuend>
            <Subtrahends>
              <Dollar>200000</Dollar>
            </Subtrahends>
          </Subtract>
          <Dollar>0</Dollar>
        </GreaterOf>
      </Derived>
    </Fact>
    <Fact path="/excessAmountQpvlidForNonMFJFiler">
      <Derived>
        <GreaterOf>
          <Subtract>
            <Minuend>
              <Dependency path="/magiForOB3BelowLineDeductions"/>
            </Minuend>
            <Subtrahends>
              <Dollar>100000</Dollar>
            </Subtrahends>
          </Subtract>
          <Dollar>0</Dollar>
        </GreaterOf>
      </Derived>
    </Fact>
    <Fact path="/excessOverThresholdQPVLID">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dependency path="/excessAmountQPVLIDForMFJFiler"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="/excessAmountQpvlidForNonMFJFiler"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/phaseOutAmountQPVLID">
      <Name>Qualified Personal Vehicle Loan Amount Phase Out</Name>
      <Description>The amount which is otherwise allowable as a deduction under subsection (a) as
        qualified passenger vehicle loan interest (determined without regard to this clause and
        after the application of clause (i)) shall be reduced (but not below zero) by $200 for each $1,000
        (or portion thereof) by which the modified adjusted gross income of the taxpayer for the
        taxable year exceeds $100,000 ($200,000 in the case of a joint return).

        Phaseout amount for the qualified personal vehicle loan deduction:
        phaseOutAmount= 200*(filing= 200*(filing status specific MAGI/1000)status specific MAGI/1000)
      </Description>
      <Derived>
        <StepwiseMultiply>
          <Multiplicand>
            <Dependency path="/excessOverThresholdQPVLID"/>
          </Multiplicand>
          <Rate>
            <!-- Reduce by a rate of $200 for each $1000 of MAGI exceeding the relevant threshold -->
            <Rational>200/1000</Rational>
          </Rate>
        </StepwiseMultiply>
      </Derived>
    </Fact>
    <Fact path="/tentativeQualifiedPersonalVehicleLoanInterestDeduction">
      <Name>Tentative amount of the personal vehicle loan interest deduction</Name>
      <Description>The lesser of 10000 or actual interest paid minus phase out amount, with a lowest
        possible
        value of 0
      </Description>
      <Derived>
        <GreaterOf>
          <LesserOf>
            <Dependency path="/maxQPVLIDAmount"/>
            <Subtract>
              <Minuend>
                <Dependency path="/personalVehicleLoanInterestAmount"/>
              </Minuend>
              <Subtrahends>
                <Dependency path="/phaseOutAmountQPVLID"/>
              </Subtrahends>
            </Subtract>
          </LesserOf>
          <Dollar>0</Dollar>
        </GreaterOf>
      </Derived>
    </Fact>
    <Fact path="/qualifiedPersonalVehicleLoanInterestDeduction">
      <Name>Actual amount of the personal vehicle loan interest deduction</Name>
      <Description>Defaults to 0 if QPVLID section is not complete</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <All>
                <IsComplete>
                  <Dependency path="/isEligibleForQualifiedPassengerVehicleLoanInterestDeduction"/>
                </IsComplete>
                <Dependency path="/isEligibleForQualifiedPassengerVehicleLoanInterestDeduction"/>
              </All>
            </When>
            <Then>
              <Dependency path="/tentativeQualifiedPersonalVehicleLoanInterestDeduction"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
