<?xml version="1.0"?>
<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/cdccQualifyingPersons">
      <Name>Number of CDCC qualifying persons</Name>
      <Description>The number of people who are eligible for the CDCC. Form 2441 Line 2a, aggregated</Description>
      <Writable>
        <Int/>
        <Limit type="Min">
          <Int>0</Int>
        </Limit>
      </Writable>
      <Placeholder>
        <Int>0</Int>
      </Placeholder>
    </Fact>
    <Fact path="/cdccQualifyingExpenses">
      <Description>Child and Dependent Care qualifying expenses. Form 2441 Line 2d, aggregated</Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/flowIsEligibleForCDCC">
      <Description>Taxpayers who 1) have CDCC earned income; and 2) are non-MFS or MFS and didn't live together should see the CDCC section of the flow.MFS taxpayers generally cannot claim CDCC, in particular if they will live together for the entire year. If they are MFS and do not live together all year, or any non-MFS status, they are eligible </Description>
      <Derived>
        <All>
          <Dependency path="/hasCdccEarnedIncome"/>
          <Any>
            <Not>
              <Dependency path="/isFilingStatusMFS"/>
            </Not>
            <Not>
              <Dependency path="/isMFSLivedTogether"/>
            </Not>
          </Any>
        </All>
      </Derived>
    </Fact>
    <Fact path="/cdccMaxClaimableExpenseWithOneQP">
      <Name>Maximum Claimable Expense With One Qualifying Person</Name>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>3000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/cdccMaxClaimableExpenseWithTwoQP">
      <Name>Maximum Claimable Expense With Two or More Qualifying Persons</Name>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>6000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/cdccMaxAllowedCreditWithOneQP">
      <Name>Maximum Allowed Credit With One Qualifying Person</Name>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>1500</Dollar>
      </Derived>
    </Fact>
    <Fact path="/cdccMaxAllowedCreditWithTwoQP">
      <Name>Maximum Allowed Credit With Two or More Qualifying Persons</Name>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>3000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/cdccCareExpensesInitialPhaseOutRate">
      <TaxYear>2026</TaxYear>
      <Derived>
        <!-- .01 for every whole $2,000 of income -->
        <Rational>1/2000</Rational>
      </Derived>
    </Fact>
    <Fact path="/cdccCareExpensesAdditionalPhaseOutRate">
      <TaxYear>2026</TaxYear>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <!-- .01 for every whole $4,000 of income -->
              <Rational>1/4000</Rational>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <!-- .01 for every whole $2,000 of income -->
              <Rational>1/2000</Rational>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/cdccCareExpensesInitialPhaseInStart">
      <Description>The threshold at which the care expenses decimal amount begins reducing</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>15000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/cdccCareExpensesInitialPhaseOutThreshold">
      <Description>The threshold at which the care expenses decimal amount stops reducing past 35% (until the additional phase out starts at a higher AGI)</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>45000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/cdccCareExpensesAdditionalPhaseInStart">
      <Description>The threshold at which care expenses begin a second phase out, different depending on MFJ and non-MFJ AGI and rates </Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dollar>150000</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>75000</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/cdccCareExpensesAdditionalPhaseOutThreshold">
      <Description>The threshold at which the care expenses decimal amount stops reducing</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dollar>210000</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>105000</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/cdccQualifyingExpenseCap">
      <Name>The maximum claimable qualifying expenses</Name>
      <Description>
        The maximum claimable qualifying expenses. Also called the Allowed Cared For Amount.

        Form 2441, Line
        27
      </Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <GreaterThan>
                <Left>
                  <Dependency path="/cdccQualifyingPersons"/>
                </Left>
                <Right>
                  <Int>1</Int>
                </Right>
              </GreaterThan>
            </When>
            <Then>
              <Dependency path="/cdccMaxClaimableExpenseWithTwoQP"/>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/cdccQualifyingPersons"/>
                </Left>
                <Right>
                  <Int>1</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/cdccMaxClaimableExpenseWithOneQP"/>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/cdccQualifyingPersons"/>
                </Left>
                <Right>
                  <Int>0</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/cappedCdccQualifyingExpenses">
      <Name>Qualifying Expenses</Name>
      <Description>
        The capped sum of all qualifying expenses. Form 2441, Line 3
      </Description>
      <Derived>
        <LesserOf>
          <Dependency path="/cdccQualifyingExpenses"/>
          <Dependency path="/cdccQualifyingExpenseCap"/>
        </LesserOf>
      </Derived>
    </Fact>
    <Fact path="/lowerOfCdccEarnedIncomeMfj">
      <Description>Lowest of Earned income of MFJ filers. Form 2441 Line 5 </Description>
      <Derived>
        <LesserOf>
          <Dependency path="/earnedIncomeSelf"/>
          <Dependency path="/earnedIncomeSpouse"/>
        </LesserOf>
      </Derived>
    </Fact>
    <Fact path="/hasCdccEarnedIncome">
      <Derived>
        <GreaterThan>
          <Left>
            <Dependency path="/lowerOfCdccEarnedIncome"/>
          </Left>
          <Right>
            <Dollar>0</Dollar>
          </Right>
        </GreaterThan>
      </Derived>
    </Fact>
    <Fact path="/lowerOfCdccEarnedIncome">
      <Description>Lower of earned income (regardless of filing status). Lesser of Form 2441 Line 4 and Line 5</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dependency path="/lowerOfCdccEarnedIncomeMfj"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="/earnedIncomeSelf"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/cdccLowerOfEarnedIncomeAndExpenses">
      <Description>
        The lower of the earned income values and capped qualifying expenses
        Form 2441, Line 6
      </Description>
      <Derived>
        <LesserOf>
          <Dependency path="/cappedCdccQualifyingExpenses"/>
          <Dependency path="/lowerOfCdccEarnedIncome"/>
        </LesserOf>
      </Derived>
    </Fact>
    <Fact path="/cdccCareExpensesDecimalAmount">
      <Name>Care Expenses Decimal Amount</Name>
      <Description>Care Expenses Decimal Amount. Form 2441, Line 8. Line 7 is AGI. </Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <!--
        Note: This fact is returned as a <Dollar> because we don't have a distinct <Decimal> type currently
        and it is important
        that precision of these decimal values be preserved

        Non-MFJ
        0 ≤ AGI ≤ 15,000: P=50%
        15,000 < AGI ≤ 45,000: P=50%−((AGI−15,000)×0.0005)
        45,000 < AGI≤ 75,000: P=35%
        75,000 < AGI≤ 105,000: P=35%−((AGI−75,000)×0.0005)
        AGI > 105,000: P=20%

        MFJ
        0 ≤ AGI ≤15,000: P=50%
        15,000 < AGI ≤45,000: P=50%−((AGI−15,000)×0.0005)
        45,000 <AGI ≤150,000: P=35%
        150,000 < AGI ≤210,000: P=35%−((AGI−150,000)×0.00025)
        AGI > 210,000: P=20%
      -->
        <Switch>
          <Case>
            <!-- Zero or negative AGI = no liability = no nonrefundable credits            -->
            <When>
              <LessThanOrEqual>
                <Left>
                  <Dependency path="/agi"/>
                </Left>
                <Right>
                  <Dollar>0</Dollar>
                </Right>
              </LessThanOrEqual>
            </When>
            <Then>
              <Dollar>0.00</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <!-- AGI < initial phase in threshold ($15,000), 50% decimal amount-->
              <LessThanOrEqual>
                <Left>
                  <Dependency path="/agi"/>
                </Left>
                <Right>
                  <Dependency path="/cdccCareExpensesInitialPhaseInStart"/>
                </Right>
              </LessThanOrEqual>
            </When>
            <Then>
              <Dollar>
                0.50
              </Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <!-- AGI > initial phase in ($15,000) && AGI <= initial phase out threshold ($45,000), phase down from 50% to 35% decimal amount-->
              <All>
                <GreaterThan>
                  <Left>
                    <Dependency path="/agi"/>
                  </Left>
                  <Right>
                    <Dependency path="/cdccCareExpensesInitialPhaseInStart"/>
                  </Right>
                </GreaterThan>
                <LessThanOrEqual>
                  <Left>
                    <Dependency path="/agi"/>
                  </Left>
                  <Right>
                    <Dependency path="/cdccCareExpensesInitialPhaseOutThreshold"/>
                  </Right>
                </LessThanOrEqual>
              </All>
            </When>
            <Then>
              <!--
            The decimal amount reduces by .01 for every 2K over 15,000.01 until 45,000.00
            This formula is emulating the effects of this table from the form 2441 instructions: Non-MFJ-->
              <Subtract>
                <Minuend>
                  <!-- The case statement above handles 15K and down, so we start from the second row -->
                  <Dollar>0.49</Dollar>
                </Minuend>
                <Subtrahends>
                  <Divide>
                    <Dividend>
                      <StepwiseMultiply>
                        <Multiplicand>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/agi"/>
                            </Minuend>
                            <Subtrahends>
                              <!--
                                The increment steps up at one cent over each 2K threshold,
                                so we need to take away an extra penny to compensate
                              -->
                              <Add>
                                <Dependency path="/cdccCareExpensesInitialPhaseInStart"/>
                                <Dollar>0.01</Dollar>
                              </Add>
                            </Subtrahends>
                          </Subtract>
                        </Multiplicand>
                        <Rate>
                          <Dependency path="/cdccCareExpensesInitialPhaseOutRate"/>
                        </Rate>
                      </StepwiseMultiply>
                    </Dividend>
                    <Divisors>
                      <!-- Stepwise multiple doesn't support decimal rates, so we have to convert
                      from percent to
                      decimal -->
                      <Int>100</Int>
                    </Divisors>
                  </Divide>
                </Subtrahends>
              </Subtract>
            </Then>
          </Case>
          <Case>
            <When>
              <!-- AGI > initial phase out threshold ($45,000) && AGI <= additional phase in threshold ($75k non-MFJ, $150k MFJ), 35% decimal amount-->
              <All>
                <GreaterThan>
                  <Left>
                    <Dependency path="/agi"/>
                  </Left>
                  <Right>
                    <Dependency path="/cdccCareExpensesInitialPhaseOutThreshold"/>
                  </Right>
                </GreaterThan>
                <LessThanOrEqual>
                  <Left>
                    <Dependency path="/agi"/>
                  </Left>
                  <Right>
                    <Dependency path="/cdccCareExpensesAdditionalPhaseInStart"/>
                  </Right>
                </LessThanOrEqual>
              </All>
            </When>
            <Then>
              <Dollar>
                0.35
              </Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <All>
                <GreaterThan>
                  <Left>
                    <Dependency path="/agi"/>
                  </Left>
                  <Right>
                    <Dependency path="/cdccCareExpensesAdditionalPhaseInStart"/>
                  </Right>
                </GreaterThan>
                <LessThanOrEqual>
                  <Left>
                    <Dependency path="/agi"/>
                  </Left>
                  <Right>
                    <Dependency path="/cdccCareExpensesAdditionalPhaseOutThreshold"/>
                  </Right>
                </LessThanOrEqual>
              </All>
            </When>
            <Then>
              <!--              Starting at 34%-->
              <!--            For non-MFJ, the decimal amount reduces by .01 for every 2K over 75,000.01 until 105,000.00-->
              <!--            For MFJ, the decimal amount reduces by .01 for every 4K over 150,000.01 until 210,000.00-->
              <Subtract>
                <Minuend>
                  <Dollar>0.34</Dollar>
                </Minuend>
                <Subtrahends>
                  <Divide>
                    <Dividend>
                      <StepwiseMultiply>
                        <Multiplicand>
                          <Subtract>
                            <Minuend>
                              <Dependency path="/agi"/>
                            </Minuend>
                            <Subtrahends>
                              <!--
                                The increment steps up at one cent over each 2K threshold,
                                so we need to take away an extra penny to compensate
                              -->
                              <Add>
                                <Dependency path="/cdccCareExpensesAdditionalPhaseInStart"/>
                                <Dollar>0.01</Dollar>
                              </Add>
                            </Subtrahends>
                          </Subtract>
                        </Multiplicand>
                        <Rate>
                          <Dependency path="/cdccCareExpensesAdditionalPhaseOutRate"/>
                        </Rate>
                      </StepwiseMultiply>
                    </Dividend>
                    <Divisors>
                      <!-- Stepwise multiple doesn't support decimal rates, so we have to convert
                      from percent to
                      decimal -->
                      <Int>100</Int>
                    </Divisors>
                  </Divide>
                </Subtrahends>
              </Subtract>
            </Then>
          </Case>
          <Case>
            <When>
              <!-- AGI > additional phase out threshold has a flat 20% rate -->
              <True/>
            </When>
            <Then>
              <Dollar>0.20</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/cdccTentativeExpenseAmount">
      <Name>Tentative Expense Amount</Name>
      <Description> Form 2441, Line 9a
      </Description>
      <Derived>
        <Round>
          <Multiply>
            <Dependency path="/cdccLowerOfEarnedIncomeAndExpenses"/>
            <Dependency path="/cdccCareExpensesDecimalAmount"/>
          </Multiply>
        </Round>
      </Derived>
    </Fact>
    <Fact path="/cdccCreditForPriorYearExpenses">
      <Name>Credit For Prior Year Expenses</Name>
      <Description>
        Credit for any expenses incurred in the prior tax year. Not currently supported, so this is set as  zero.
        Form 2441, Line 9b
      </Description>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>
    <Fact path="/currentAndLastYearExpenseAmount">
      <Description>
        Form 2441, Line 9c
      </Description>
      <Derived>
        <Add>
          <Dependency path="/cdccTentativeExpenseAmount"/>
          <Dependency path="/cdccCreditForPriorYearExpenses"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/cdccCreditLimit">
      <Name>Tax Liability Credit Limit</Name>
      <Description>
        The maximum possible credit the filer can receive for CDCC, calculated using the Credit Limit Worksheet
      </Description>
      <!--
        Calculated using the "Credit Limit Worksheet"

        Credit Limit Worksheet
        Complete this worksheet to figure the amount to enter on line 10.
        1.	Enter the amount from Form 1040, 1040-SR, or 1040-NR, line 18	1.	_____
        2.	Enter the amount from Schedule 3 (Form 1040), line 1 (foreign tax credit) and line 6l (Form
      8978, line 14)	2.	_____
        3.	Subtract line 2 from line 1. Also enter this amount on Form 2441, line 10. But if zero or less,
      stop; you can’t take
      the credit
      -->
      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="/totalTentativeTax"/>
          </Minuend>
          <Subtrahends>
            <Dependency path="/schedule3Line1"/>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>
    <Fact path="/creditForChildAndDependentCareExpenses">
      <Description>Credit for child and dependent care expenses. Smaller of line 9c or line 10 Form 2441 Line 11. Input on Schedule 3 Line 2</Description>
      <Derived>
        <LesserOf>
          <Dependency path="/currentAndLastYearExpenseAmount"/>
          <Dependency path="/cdccCreditLimit"/>
        </LesserOf>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
