<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/filers">
      <Description>This filers collection should be populated by app code to contain exactly
        two items.</Description>
      <Writable>
        <Collection />
      </Writable>
    </Fact>

    <Fact path="/primaryFiler">
      <Description>The first collection item represents the primary filer.</Description>
      <Derived>
        <IndexOf>
          <Collection>
            <Dependency path="/filers" />
          </Collection>
          <Index>
            <Int>0</Int>
          </Index>
        </IndexOf>
      </Derived>
    </Fact>

    <Fact path="/secondaryFiler">
      <Description>The second collection item represents the secondary filer, who may or may
        not exist in reality.</Description>
      <Derived>
        <IndexOf>
          <Collection>
            <Dependency path="/filers" />
          </Collection>
          <Index>
            <Int>1</Int>
          </Index>
        </IndexOf>
      </Derived>
    </Fact>

    <Fact path="/filers/*/isBlind">
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/filers/*/isClaimedOnAnotherReturn">
      <Writable>
        <Boolean />
      </Writable>
    </Fact>

    <Fact path="/treatFilersAsDependents">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ" />
            </When>
            <Then>
              <Any>
                <Dependency path="/primaryFiler/isClaimedOnAnotherReturn" />
                <Dependency path="/secondaryFiler/isClaimedOnAnotherReturn" />
              </Any>
            </Then>
          </Case>
          <Case>
            <When>
              <True />
            </When>
            <Then>
              <Dependency path="/primaryFiler/isClaimedOnAnotherReturn" />
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>

    <Fact path="/filers/*/dateOfBirth">
      <Name>Date of birth</Name>
      <Description>The date of birth of the filer.</Description>
      <Writable>
        <Day />
        <Limit type="Max">
          <Day>2024-01-01</Day>
        </Limit>
      </Writable>
    </Fact>

    <Fact path="/filers/*/dayBeforeDateOfBirth">
      <Description>The day before the filer's birthday</Description>
      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="../dateOfBirth" />
          </Minuend>
          <Subtrahends>
            <Days>1</Days>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>

    <Fact path="/filers/*/ageCalculatedDayBeforeDOB">
      <Description>The age of the filer, calculated using their birthday as the day before
        their date of birth.</Description>
      <Derived>
        <Subtract>
          <Minuend>
            <Dependency module="constants" path="/taxYear" />
          </Minuend>
          <Subtrahends>
            <Dependency path="../dayBeforeDateOfBirth/year" />
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>

    <Fact path="/filers/*/age65OrOlder">
      <Name>Age 65 or older</Name>
      <Description>
        Whether the filer is 65 or older. Pub 554 states "You are considered age 65 at the
        end of the year if your 65th birthday is on or before January 1 of the following
        year" so we include the January 1 exception here.
        Do NOT use this fact for EITC calculations -- That age 65 requirement does _not_
        have the January 1 exception.
      </Description>

      <Derived>
        <GreaterThanOrEqual>
          <Left>
            <Dependency path="../ageCalculatedDayBeforeDOB" />
          </Left>
          <Right>
            <Int>65</Int>
          </Right>
        </GreaterThanOrEqual>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
