<?xml version="1.0"?>
<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <!--    WRITABLES START HERE-->
    <Fact path="/jobs">
      <Description>The taxpayers's jobs</Description>
      <Writable>
        <Collection/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/isAllYear">
      <Description>Whether this job was held for the entire tax year.</Description>
      <Writable>
        <Boolean/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/writableStartDate">
      <Description>The first date the job was held in the current calendar year, if not an all year
        job.</Description>
      <TaxYear>2025</TaxYear>
      <!-- Note that the limits on dates may be more restrictive in the future based on component
           implementation -->
      <!-- E.g., a future job cannot start before tomorrow -->
      <Writable>
        <Day/>
        <Limit type="Max">
          <Day>2025-12-31</Day>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/writableEndDate">
      <Description>The last date the job was held in the current calendar year, if not an all year
        job.</Description>
      <TaxYear>2025</TaxYear>
      <Writable>
        <Day/>
        <Limit type="Max">
          <Day>2025-12-31</Day>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/mostRecentPayPeriodEnd">
      <Description>
        The date which the most recent pay period ended on for this particular job
      </Description>
      <Writable>
        <Day/>
        <Limit type="Max">
          <Day>2025-12-31</Day>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/mostRecentPayDate">
      <Description>
        The date on which pay was received, corresponding to the most recent pay period that ended
      </Description>
      <Writable>
        <Day/>
        <Limit type="Max">
          <Day>2025-12-31</Day>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/averagePayPerPayPeriod">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/yearToDateIncome">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/yearToDateWithholding">
      <Description>The year-to-date withholding from a specific job</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/averageWithholdingPerPayPeriod">
      <Description>The average withholding from a specific job per pay period</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/payFrequency">
      <Name>Pay Frequency</Name>
      <Description>The frequency that the job pays the user. And the length of pay periods.</Description>
      <Writable>
        <Enum optionsPath="/payFrequencyOptions"/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/totalBonusReceived">
      <Description>The total amount of bonus per year for a specific job</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/retirementPlanContributions">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/healthInsuranceContributions">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/hsaOrFsaContributions">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <!--    DERIVATION LOGIC STARTS HERE. payPeriodCalculations.xml does the heavy lifting for calculating
    remaining pay periods. withholdingCalculations.xml does the heavy lifting for W4 results and recommendations
    -->
    <Fact path="/jobs/*/income">
      <Description>The total income from a specific job</Description>
      <Derived>
        <Subtract>
          <Minuend>
            <Add>
              <Dependency path="../restOfYearIncome"/>
              <Dependency path="../yearToDateIncome"/>
            </Add>
          </Minuend>
          <Subtrahends>
            <Dependency path="../preTaxDeductions"/>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/preTaxDeductions">
      <Description>Pre-tax deductions from a specific job</Description>
      <Derived>
        <Add>
          <Dependency path="../retirementPlanContributions"/>
          <Dependency path="../healthInsuranceContributions"/>
          <Dependency path="../hsaOrFsaContributions"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/flowAskPartYearDates">
      <Description>Flow control: whether to ask start and end dates for this job.</Description>
      <Derived>
        <Not>
          <Dependency path="../isAllYear"/>
        </Not>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/startDate">
      <Description>The first date the job was held in the current calendar year.</Description>
      <TaxYear>2025</TaxYear>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isAllYear"/>
            </When>
            <Then>
              <Day>2025-01-01</Day>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="../writableStartDate"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/endDate">
      <Description>The last date the job was held in the current calendar year.</Description>
      <TaxYear>2025</TaxYear>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isAllYear"/>
            </When>
            <Then>
              <Day>2025-12-31</Day>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="../writableEndDate"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isHeldToYearEnd">
      <Description>Does the filer hold this job at the end of the year?</Description>
      <Derived>
        <GreaterThanOrEqual>
          <Left>
            <Dependency path="../endDate/ordinal"/>
          </Left>
          <Right>
            <Dependency path="/daysInYear"/>
          </Right>
        </GreaterThanOrEqual>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPastJob">
      <Derived>
        <LessThan>
          <Left>
            <Dependency path="../endDate"/>
          </Left>
          <Right>
            <Dependency path="/today"/>
          </Right>
        </LessThan>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isCurrentJob">
      <Derived>
        <All>
          <LessThanOrEqual>
            <Left>
              <Dependency path="/today"/>
            </Left>
            <Right>
              <Dependency path="../endDate"/>
            </Right>
          </LessThanOrEqual>
          <GreaterThanOrEqual>
            <Left>
              <Dependency path="/today"/>
            </Left>
            <Right>
              <Dependency path="../startDate"/>
            </Right>
          </GreaterThanOrEqual>
        </All>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isFutureJob">
      <Derived>
        <LessThan>
          <Left>
            <Dependency path="/today"/>
          </Left>
          <Right>
            <Dependency path="../startDate"/>
          </Right>
        </LessThan>
      </Derived>
    </Fact>
    <Fact path="/payFrequencyOptions">
      <Name>Pay Frequency Options</Name>
      <Description>Options for pay frequency</Description>
      <Derived>
        <EnumOptions>
          <String>weekly</String>
          <String>biWeekly</String>
          <String>semiMonthly</String>
          <String>monthly</String>
        </EnumOptions>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPayFrequencyWeekly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">weekly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPayFrequencyBiWeekly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">biWeekly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPayFrequencySemiMonthly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">semiMonthly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPayFrequencyMonthly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">monthly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/payPeriodLength">
      <Description>Length of pay periods matching the Floor of Publication 15-T values.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyWeekly"/>
            </When>
            <Then>
              <Int>7</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyBiWeekly"/>
            </When>
            <Then>
              <Int>14</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencySemiMonthly"/>
            </When>
            <Then>
              <Int>15</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyMonthly"/>
            </When>
            <Then>
              <Int>30</Int>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/zeroIndexedStartDay">
      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="../startDate/day"/>
          </Minuend>
          <Subtrahends>
            <Int>1</Int>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>
    <Fact path="/totalBonusReceivedThreshold">
      <Description>Threshold for changing bonus withholdings from 22% to 37%</Description>
      <TaxYear>2025</TaxYear>
      <Derived>
        <Dollar>1000000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/payPeriodsPerYear">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyWeekly"/>
            </When>
            <Then>
              <Int>52</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyBiWeekly"/>
            </When>
            <Then>
              <Int>26</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencySemiMonthly"/>
            </When>
            <Then>
              <Int>24</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyMonthly"/>
            </When>
            <Then>
              <Int>12</Int>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/lastDayOfStartMonth">
      <Derived>
        <LastDayOfMonth>
          <Dependency path="../startDate"/>
        </LastDayOfMonth>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/lastDayOfEndMonth">
      <Derived>
        <LastDayOfMonth>
          <Dependency path="../endDate"/>
        </LastDayOfMonth>
      </Derived>
    </Fact>
    <Fact path="/yearEndJobs">
      <Derived>
        <Filter path="/jobs">
          <Dependency path="isHeldToYearEnd"/>
        </Filter>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
