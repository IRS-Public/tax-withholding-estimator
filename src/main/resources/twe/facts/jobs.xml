<?xml version="1.0"?>
<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <!--    WRITABLES START HERE-->
    <Fact path="/jobs">
      <Description>The taxpayers's jobs</Description>
      <Writable>
        <Collection/>
      </Writable>
    </Fact>
    <Fact path="/filerAssignmentOption">
      <Name>Filer Assignment Option</Name>
      <Derived>
        <EnumOptions>
          <String>self</String>
          <String>spouse</String>
        </EnumOptions>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/filerAssignment">
      <Description>Whether this job is attributed to the primary filer or spouse if MFJ</Description>
      <Override>
        <Condition>
          <!-- If the filing status is non-MFJ, the default must be a self assignment -->
          <Not>
            <Dependency path="/isFilingStatusMFJ"/>
          </Not>
        </Condition>
        <Default>
          <Enum optionsPath="/filerAssignmentOption">self</Enum>
        </Default>
      </Override>
      <Writable>
        <Enum optionsPath="/filerAssignmentOption"/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/isAllYear">
      <Description>Whether this job was held for the entire tax year.</Description>
      <Writable>
        <Boolean/>
      </Writable>
    </Fact>
    <Fact path="/overTimeCompensationRates">
      <Derived>
        <EnumOptions>
          <String>onePointFive</String>
          <String>two</String>
        </EnumOptions>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/overtimeCompensation">
      <Name>Overtime Compensation Excluding Qualified Tip Overtime Comp</Name>
      <Description>OB3 &#xA7;70202 IRC &#xA7;225(c)(2). Overtime compensation excluding all
        qualified tips defined in IRC &#xA7;224 that were received as part of qualified overtime compensation</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="../overtimeCompensationRate"/>
                </Left>
                <Right>
                  <Enum optionsPath="/overTimeCompensationRates">onePointFive</Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Multiply>
                <Rational>1/3</Rational>
                <Dependency path="../overtimeCompensationTotal"/>
              </Multiply>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="../overtimeCompensationRate"/>
                </Left>
                <Right>
                  <Enum optionsPath="/overTimeCompensationRates">two</Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Multiply>
                <Rational>1/2</Rational>
                <Dependency path="../overtimeCompensationTotal"/>
              </Multiply>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="../overtimeCompensationTotal"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/overtimeCompensationTotal">
      <Description>Total amount of overtime paid to the taxpayer, with no regard to the excess over normal wages</Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/overtimeCompensationRate">
      <Description>Multiplier provided by the taxpayer that indicates whether they are paid at a time and a half (1.5) or double time (2.0) overtime rate</Description>
      <Writable>
        <Enum optionsPath="/overTimeCompensationRates"/>
      </Writable>
      <Placeholder>
        <Enum optionsPath="/overTimeCompensationRates">onePointFive</Enum>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/qualifiedTipIncome">
      <Name>Qualified Tip Income</Name>
      <Description>OB3 &#xA7;70201; IRC &#xA7;224. Qualified tip income</Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/writableStartDate">
      <Description>The first date the job was held in the current calendar year, if not an all year
        job.</Description>
      <TaxYear>2026</TaxYear>
      <!-- Note that the limits on dates may be more restrictive in the future based on component
           implementation -->
      <!-- E.g., a future job cannot start before tomorrow -->
      <Writable>
        <Day/>
        <Limit type="Max">
          <Dependency path="/yearEndDate"/>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/writableEndDate">
      <Description>The last date the job was held in the current calendar year, if not an all year
        job.</Description>
      <TaxYear>2026</TaxYear>
      <Writable>
        <Day/>
        <Limit type="Max">
          <Dependency path="/yearEndDate"/>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/mostRecentPayPeriodEnd">
      <Description>
        The date which the most recent pay period ended on for this particular job
      </Description>
      <Writable>
        <Day/>
        <Limit type="Max">
          <Dependency path="/yearEndDate"/>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/mostRecentPayDate">
      <Description>
        The date on which pay was received, corresponding to the most recent pay period that ended
      </Description>
      <Writable>
        <Day/>
        <Limit type="Max">
          <Dependency path="/yearEndDate"/>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/inconsistentPay">
      <Writable>
        <Boolean/>
      </Writable>
      <Placeholder>
        <False/>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/amountLastPaycheck">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/averagePayPerPayPeriod">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../inconsistentPay"/>
            </When>
            <Then>
              <Dependency path="../inconsistentPayAverage"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="../amountLastPaycheck"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/inconsistentPayAverage">
      <Derived>
        <Switch>
          <!--
            There are only two cases here: two past paychecks, or three.
            Entering at least two paycheks is required if you select "inconsistent pay"
          -->
          <Case>
            <When>
              <IsComplete>
                <Dependency path="../pastPaycheckIncome3"/>
              </IsComplete>
            </When>
            <Then>
              <Divide>
                <Dividend>
                  <Add>
                    <Dependency path="../pastPaycheckIncome1"/>
                    <Dependency path="../pastPaycheckIncome2"/>
                    <Dependency path="../pastPaycheckIncome3"/>
                  </Add>
                </Dividend>
                <Divisors>
                  <Int>3</Int>
                </Divisors>
              </Divide>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Divide>
                <Dividend>
                  <Add>
                    <Dependency path="../pastPaycheckIncome1"/>
                    <Dependency path="../pastPaycheckIncome2"/>
                  </Add>
                </Dividend>
                <Divisors>
                  <Int>2</Int>
                </Divisors>
              </Divide>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/pastPaycheckIncome1">
      <!-- This is the most recent paycheck -->
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/pastPaycheckIncome2">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/pastPaycheckIncome3">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/yearToDateIncome">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/yearToDateWithholding">
      <Description>The year-to-date withholding from a specific job</Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/averageWithholdingPerPayPeriod">
      <Description>The average withholding from a specific job per pay period</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../inconsistentPay"/>
            </When>
            <Then>
              <Multiply>
                <!-- Get the percentage withheld from the most recent paycheck -->
                <Divide>
                  <Dividend>
                    <Dependency path="../amountWithheldLastPaycheck"/>
                  </Dividend>
                  <Divisors>
                    <Dependency path="../pastPaycheckIncome1"/>
                  </Divisors>
                </Divide>
                <!-- Multiply it by the average pay to estimate the average withholding -->
                <Dependency path="../inconsistentPayAverage"/>
              </Multiply>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="../amountWithheldLastPaycheck"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/amountWithheldLastPaycheck">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/payFrequency">
      <Name>Pay Frequency</Name>
      <Description>The frequency that the job pays the user. And the length of pay periods.</Description>
      <Writable>
        <Enum optionsPath="/payFrequencyOptions"/>
      </Writable>
    </Fact>
    <Fact path="/jobs/*/totalBonusReceived">
      <Description>The total amount of bonus per year for a specific job</Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/retirementPlanContributionsToDate">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/healthInsuranceContributionsToDate">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/hsaOrFsaContributionsToDate">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/retirementPlanContributionsPerPayPeriod">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/healthInsuranceContributionsPerPayPeriod">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/hsaOrFsaContributionsPerPayPeriod">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/jobs/*/income">
      <Description>
        The total income from a specific job.
        This is *not* just the base pay: Taxpayers provide their paychecks with tips and overtime included, so those
        do not need to be added in separately here.
      </Description>
      <Derived>
        <Subtract>
          <Minuend>
            <Add>
              <Dependency path="../restOfYearIncome"/>
              <Dependency path="../yearToDateIncome"/>
            </Add>
          </Minuend>
          <Subtrahends>
            <Dependency path="../preTaxDeductions"/>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/preTaxDeductions">
      <Description>Pre-tax deductions from a specific job</Description>
      <Derived>
        <Add>
          <Dependency path="../retirementPlanContributions"/>
          <Dependency path="../healthInsuranceContributions"/>
          <Dependency path="../hsaOrFsaContributions"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/retirementPlanContributions">
      <Description>Pre-tax deductions from a specific job</Description>
      <Derived>
        <Add>
          <Dependency path="../retirementPlanContributionsToDate"/>
          <Multiply>
            <Dependency path="../retirementPlanContributionsPerPayPeriod"/>
            <Dependency path="../remainingPayPeriodsInteger"/>
          </Multiply>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/healthInsuranceContributions">
      <Description>Pre-tax deductions from a specific job</Description>
      <Derived>
        <Add>
          <Dependency path="../healthInsuranceContributionsToDate"/>
          <Multiply>
            <Dependency path="../healthInsuranceContributionsPerPayPeriod"/>
            <Dependency path="../remainingPayPeriodsInteger"/>
          </Multiply>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/hsaOrFsaContributions">
      <Description>Pre-tax deductions from a specific job</Description>
      <Derived>
        <Add>
          <Dependency path="../hsaOrFsaContributionsToDate"/>
          <Multiply>
            <Dependency path="../hsaOrFsaContributionsPerPayPeriod"/>
            <Dependency path="../remainingPayPeriodsInteger"/>
          </Multiply>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/preTaxDeductionsPerPayPeriod">
      <Description>
        The pre-tax deductions being taken out of a particular paycheck.
        These are used to get an accurate calculation on the Pub15T withholding tables, not to
        calculate overall tax burden.
      </Description>
      <Derived>
        <Add>
          <Dependency path="../retirementPlanContributionsPerPayPeriod"/>
          <Dependency path="../healthInsuranceContributionsPerPayPeriod"/>
          <Dependency path="../hsaOrFsaContributionsPerPayPeriod"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/flowAskPartYearDates">
      <Description>Flow control: whether to ask start and end dates for this job.</Description>
      <Derived>
        <Not>
          <Dependency path="../isAllYear"/>
        </Not>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/startDate">
      <Description>The first date the job was held in the current calendar year.</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isAllYear"/>
            </When>
            <Then>
              <Dependency path="/yearStartDate"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="../writableStartDate"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/endDate">
      <Description>The last date the job was held in the current calendar year.</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isAllYear"/>
            </When>
            <Then>
              <Dependency path="/yearEndDate"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dependency path="../writableEndDate"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isHeldToYearEnd">
      <Description>Does the filer hold this job at the end of the year?</Description>
      <Derived>
        <GreaterThanOrEqual>
          <Left>
            <Dependency path="../endDate/ordinal"/>
          </Left>
          <Right>
            <Dependency path="/daysInYear"/>
          </Right>
        </GreaterThanOrEqual>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPastJob">
      <Derived>
        <LessThanOrEqual>
          <Left>
            <Dependency path="../endDate"/>
          </Left>
          <Right>
            <Dependency path="/today"/>
          </Right>
        </LessThanOrEqual>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isCurrentJob">
      <Derived>
        <All>
          <LessThanOrEqual>
            <Left>
              <Dependency path="/today"/>
            </Left>
            <Right>
              <Dependency path="../endDate"/>
            </Right>
          </LessThanOrEqual>
          <GreaterThanOrEqual>
            <Left>
              <Dependency path="/today"/>
            </Left>
            <Right>
              <Dependency path="../startDate"/>
            </Right>
          </GreaterThanOrEqual>
        </All>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isFutureJob">
      <Derived>
        <LessThan>
          <Left>
            <Dependency path="/today"/>
          </Left>
          <Right>
            <Dependency path="../startDate"/>
          </Right>
        </LessThan>
      </Derived>
    </Fact>
    <Fact path="/payFrequencyOptions">
      <Name>Pay Frequency Options</Name>
      <Description>Options for pay frequency</Description>
      <Derived>
        <EnumOptions>
          <String>weekly</String>
          <String>biWeekly</String>
          <String>semiMonthly</String>
          <String>monthly</String>
        </EnumOptions>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPayFrequencyWeekly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">weekly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPayFrequencyBiWeekly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">biWeekly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPayFrequencySemiMonthly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">semiMonthly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/isPayFrequencyMonthly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">monthly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/zeroIndexedStartDay">
      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="../startDate/day"/>
          </Minuend>
          <Subtrahends>
            <Int>1</Int>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>
    <Fact path="/totalBonusReceivedThreshold">
      <Description>Threshold for changing bonus withholdings from 22% to 37%</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>1000000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/payPeriodsPerYear">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyWeekly"/>
            </When>
            <Then>
              <Int>52</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyBiWeekly"/>
            </When>
            <Then>
              <Int>26</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencySemiMonthly"/>
            </When>
            <Then>
              <Int>24</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyMonthly"/>
            </When>
            <Then>
              <Int>12</Int>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/lastDayOfStartMonth">
      <Derived>
        <LastDayOfMonth>
          <Dependency path="../startDate"/>
        </LastDayOfMonth>
      </Derived>
    </Fact>
    <Fact path="/jobs/*/lastDayOfEndMonth">
      <Derived>
        <LastDayOfMonth>
          <Dependency path="../endDate"/>
        </LastDayOfMonth>
      </Derived>
    </Fact>
    <Fact path="/possibleW4Jobs">
      <Derived>
        <Filter path="/jobs">
          <Not>
            <Dependency path="isPastJob"/>
          </Not>
        </Filter>
      </Derived>
    </Fact>
    <Fact path="/yearEndJobs">
      <Derived>
        <Filter path="/jobs">
          <Dependency path="isHeldToYearEnd"/>
        </Filter>
      </Derived>
    </Fact>
    <Fact path="/jobsAssignedToSelf">
      <Derived>
        <Filter path="/jobs">
          <Equal>
            <Left>
              <Dependency path="filerAssignment"/>
            </Left>
            <Right>
              <Enum optionsPath="/filerAssignmentOption">self</Enum>
            </Right>
          </Equal>
        </Filter>
      </Derived>
    </Fact>
    <Fact path="/jobsAssignedToSpouse">
      <Derived>
        <Filter path="/jobs">
          <Equal>
            <Left>
              <Dependency path="filerAssignment"/>
            </Left>
            <Right>
              <Enum optionsPath="/filerAssignmentOption">spouse</Enum>
            </Right>
          </Equal>
        </Filter>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
