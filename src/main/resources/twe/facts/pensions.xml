<?xml version="1.0"?>
<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/pensions/*/w4pLine4a">
      <Description>Total non-job or pension/annuity income.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path=".."/>
                </Left>
                <Right>
                  <Dependency path="/pensionSelectedForExtraWithholding"/>
                </Right>
              </Equal>
            </When>
            <Then>
              <Round>
                <Dependency path="/totalOtherIncome"/>
              </Round>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/w4pLine4b">
      <Description>Other deductions to income.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path=".."/>
                </Left>
                <Right>
                  <Dependency path="/pensionSelectedForExtraWithholding"/>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/adjustmentsToIncome"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/pub15Worksheet1bLine1g">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dollar>12900</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>8600</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/adjustedAnnualPaymentAmount">
      <Description>Projected yearly pay with deductions removed.</Description>
      <Derived>
        <Subtract>
          <Minuend>
            <Add>
              <Dependency path="../income"/>
              <Dependency path="../w4pLine4a"/>
            </Add>
          </Minuend>
          <Subtrahends>
            <Dependency path="../w4pLine4b"/>
            <Dependency path="../pub15Worksheet1bLine1g"/>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/pub15Worksheet1bLine2cOr2d">
      <Description>Adjusted total other income (2c), or adjusted annual payment amount (2d).</Description>
      <Derived>
        <Dependency path="../adjustedAnnualPaymentAmount"/>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/pub15Worksheet1bLine2j">
      <Description>
      Standard withholding rate schedules for the form W-4P. Line 2j of Pub. 15-T Worksheet 1B.
      These amounts are generally a base withholding amount plus a percentage of the excess of
      Annual Adjusted Wages Amount. The base withholding captures the total withholding for all
      the brackets below the one that the AAWA falls into.

      Since we don't enter Part II of Step 2, this is effectively also representing
      Line 2u of Pub. 15-T Worksheet 1B.
    </Description>
      <TaxYear>2025</TaxYear>
      <Derived>
        <Round>
          <Switch>
            <!-- SINGLE OR MARRIED FILING SEPARATELY -->
            <Case>
              <When>
                <Any>
                  <Dependency module="filingStatus" path="/isFilingStatusSingle"/>
                  <Dependency module="filingStatus" path="/isFilingStatusMFS"/>
                </Any>
              </When>
              <Then>
                <Switch>
                  <!-- Less than $6,400: no withholding -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>6400</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Dollar>0</Dollar>
                    </Then>
                  </Case>
                  <!-- At least $6,400 but less than $18,325: $0 plus 10% of the excess over $6,400 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>18325</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Multiply>
                        <Rational>10/100</Rational>
                        <Subtract>
                          <Minuend>
                            <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                          </Minuend>
                          <Subtrahends>
                            <Dollar>6400</Dollar>
                          </Subtrahends>
                        </Subtract>
                      </Multiply>
                    </Then>
                  </Case>
                  <!-- At least $18,325 but less than $54,875: $1,192.50 plus 12% of the excess over
          $18,325 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>54875</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>1192.50</Dollar>
                        <Multiply>
                          <Rational>12/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>18325</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $54,875 but less than $109,750: $5,578.50 plus 22% of the excess
                over $54,875 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>109750</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>5578.50</Dollar>
                        <Multiply>
                          <Rational>22/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>54875</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $109,750 but less than $203,700: $17,651 plus 24% of the excess over
                $109,750 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>203700</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>17651</Dollar>
                        <Multiply>
                          <Rational>24/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>109750</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $203,700 but less than $256,925: $40,199 plus 32% of the excess over
                $203,700 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>256925</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>40199</Dollar>
                        <Multiply>
                          <Rational>32/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>203700</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $256,925 but less than $632,750: $57,231 plus 35% of the excess over
                $256,925 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>632750</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>57231</Dollar>
                        <Multiply>
                          <Rational>35/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>256925</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- $632,750 and above: $188,769.75 plus 37% of the excess over $632,750 -->
                  <Case>
                    <When>
                      <True/>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>188769.75</Dollar>
                        <Multiply>
                          <Rational>37/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>632750</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                </Switch>
              </Then>
            </Case>
            <Case>
              <When>
                <Any>
                  <Dependency module="filingStatus" path="/isFilingStatusMFJ"/>
                  <Dependency module="filingStatus" path="/isFilingStatusQSS"/>
                </Any>
              </When>
              <Then>
                <Switch>
                  <!-- Less than $17,100: no withholding -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>17100</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Dollar>0</Dollar>
                    </Then>
                  </Case>
                  <!-- At least $17,100 but less than $40,950: $0 plus 10% of the excess over
                $17,100 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>40950</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Multiply>
                        <Rational>10/100</Rational>
                        <Subtract>
                          <Minuend>
                            <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                          </Minuend>
                          <Subtrahends>
                            <Dollar>17100</Dollar>
                          </Subtrahends>
                        </Subtract>
                      </Multiply>
                    </Then>
                  </Case>
                  <!-- At least $40,950 but less than $114,050: $2,385 plus 12% of the excess over
                $40,950 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>114050</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>2385</Dollar>
                        <Multiply>
                          <Rational>12/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>40950</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $114,050 but less than $223,800: $11,157 plus 22% of the excess over
                $114,050 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>223800</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>11157</Dollar>
                        <Multiply>
                          <Rational>22/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>114050</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $223,800 but less than $411,700: $35,302 plus 24% of the excess over
                $223,800 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>411700</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>35302</Dollar>
                        <Multiply>
                          <Rational>24/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>223800</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $411,700 but less than $518,150: $80,398 plus 32% of the excess over
                $411,700 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>518150</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>80398</Dollar>
                        <Multiply>
                          <Rational>32/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>411700</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $518,150 but less than $768,700: $114,462 plus 35% of the excess
                over $518,150 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>768700</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>114462</Dollar>
                        <Multiply>
                          <Rational>35/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>518150</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- $768,700 and above: $202,154.50 plus 37% of the excess over $768,700 -->
                  <Case>
                    <When>
                      <True/>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>202154.50</Dollar>
                        <Multiply>
                          <Rational>37/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>768700</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                </Switch>
              </Then>
            </Case>
            <Case>
              <When>
                <Dependency module="filingStatus" path="/isFilingStatusHOH"/>
              </When>
              <Then>
                <Switch>
                  <!-- Less than $13,900: no withholding -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>13900</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Dollar>0</Dollar>
                    </Then>
                  </Case>
                  <!-- At least $13,900 but less than $30,900: $0 plus 10% of the excess over
                $13,900 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>30900</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Multiply>
                        <Rational>10/100</Rational>
                        <Subtract>
                          <Minuend>
                            <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                          </Minuend>
                          <Subtrahends>
                            <Dollar>13900</Dollar>
                          </Subtrahends>
                        </Subtract>
                      </Multiply>
                    </Then>
                  </Case>
                  <!-- At least $30,900 but less than $78,750: $1,700 plus 12% of the excess over
                $30,900 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>78750</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>1700</Dollar>
                        <Multiply>
                          <Rational>12/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>30900</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $78,750 but less than $117,250: $7,442 plus 22% of the excess over
                $78,750 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>117250</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>7442</Dollar>
                        <Multiply>
                          <Rational>22/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>78750</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $117,250 but less than $211,200: $15,912 plus 24% of the excess over
                $117,250 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>211200</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>15912</Dollar>
                        <Multiply>
                          <Rational>24/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>117250</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $211,200 but less than $264,400: $38,460 plus 32% of the excess over
                $211,200 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>264400</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>38460</Dollar>
                        <Multiply>
                          <Rational>32/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>211200</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- At least $264,400 but less than $640,250: $55,484 plus 35% of the excess over
                $264,400 -->
                  <Case>
                    <When>
                      <LessThan>
                        <Left>
                          <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                        </Left>
                        <Right>
                          <Dollar>640250</Dollar>
                        </Right>
                      </LessThan>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>55484</Dollar>
                        <Multiply>
                          <Rational>35/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>264400</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                  <!-- $640,250 and above: $187,031.50 plus 37% of the excess over $640,250 -->
                  <Case>
                    <When>
                      <True/>
                    </When>
                    <Then>
                      <Add>
                        <Dollar>187031.50</Dollar>
                        <Multiply>
                          <Rational>37/100</Rational>
                          <Subtract>
                            <Minuend>
                              <Dependency path="../pub15Worksheet1bLine2cOr2d"/>
                            </Minuend>
                            <Subtrahends>
                              <Dollar>640250</Dollar>
                            </Subtrahends>
                          </Subtract>
                        </Multiply>
                      </Add>
                    </Then>
                  </Case>
                </Switch>
              </Then>
            </Case>
          </Switch>
        </Round>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/baseAnnualWithholding">
      <Description>
      The tentative annual withholding amount. Pub. 15T Worksheet 1B Line 2u.
    </Description>
      <Derived>
        <Dependency path="../pub15Worksheet1bLine2j"/>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/tentativeWithholdingAmount">
      <Derived>
        <Divide>
          <Dividend>
            <Dependency path="../pub15Worksheet1bLine2j"/>
          </Dividend>
          <Divisors>
            <Dependency path="../payPeriodsPerYear"/>
          </Divisors>
        </Divide>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/pub15FinalWithholding">
      <Description>
      Line 4c of Pub. 15-T Worksheet 1B. The per-period withholding amount sub credits, excluding
      any extra elected on Form W-4P Line 4(c).
    </Description>
      <Derived>
        <Divide>
          <Dividend>
            <GreaterOf>
              <Subtract>
                <Minuend>
                  <Dependency path="../pub15Worksheet1bLine2j"/>
                </Minuend>
                <Subtrahends>
                  <Dependency path="/totalCredits"/>
                </Subtrahends>
              </Subtract>
              <Dollar>0</Dollar>
            </GreaterOf>
          </Dividend>
          <Divisors>
            <Dependency path="../payPeriodsPerYear"/>
          </Divisors>
        </Divide>
      </Derived>
    </Fact>
    <Fact path="/pensionsTotalCommittedWithholding">
      <Derived>
        <CollectionSum>
          <Dependency path="/pensions/*/committedWithholding"/>
        </CollectionSum>
      </Derived>
    </Fact>
    <!-- This is a temporary definition, kind of circular with other facts. -->
    <Fact path="/pensions">
      <Writable>
        <Collection/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/startDate">
      <Description>
      The start date of the pension this year
    </Description>
      <Writable>
        <Day/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/endDate">
      <Description>
      The end date of the pension this year
    </Description>
      <Writable>
        <Day/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/averagePayPerPayPeriod">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/averageWithholdingPerPayPeriod">
      <Description> Average withholding from a specific pension per pay-period. </Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/yearToDateIncome">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/income">
      <Derived>
        <Add>
          <Multiply>
            <Dependency path="../averagePayPerPayPeriod"/>
            <Dependency path="../remainingPayDates"/>
          </Multiply>
          <Dependency path="../yearToDateIncome"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/yearToDateWithholding">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/mostRecentPayDate">
      <Writable>
        <Day/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/payFrequency">
      <Writable>
        <Enum optionsPath="/payFrequencyOptions"/>
      </Writable>
    </Fact>
    <Fact path="/pensions/*/payPeriodLength">
      <Description>Length of pay periods matching the Floor of Publication 15-T values.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyWeekly"/>
            </When>
            <Then>
              <Int>7</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyBiWeekly"/>
            </When>
            <Then>
              <Int>14</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencySemiMonthly"/>
            </When>
            <Then>
              <Int>15</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyMonthly"/>
            </When>
            <Then>
              <Int>30</Int>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/payPeriodsPerYear">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyWeekly"/>
            </When>
            <Then>
              <Int>52</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyBiWeekly"/>
            </When>
            <Then>
              <Int>26</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencySemiMonthly"/>
            </When>
            <Then>
              <Int>24</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyMonthly"/>
            </When>
            <Then>
              <Int>12</Int>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/payPeriodsBeforeW4ChangesAppear">
      <Description>This is derived from the "2197 Scenarios checks" worksheet of the
      "TWESprint1_2025_UAT_WHC2197_2200" spreadsheet.</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyWeekly"/>
            </When>
            <Then>
              <Int>2</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Any>
                <Dependency path="../isPayFrequencyBiWeekly"/>
                <Dependency path="../isPayFrequencySemiMonthly"/>
              </Any>
            </When>
            <Then>
              <Int>1</Int>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyMonthly"/>
            </When>
            <Then>
              <Int>0</Int>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/committedWithholding">
      <Description>
      This pension's withholding that cannot chnage because it's past or within the time
      lag before W4 Changes kick in.
    </Description>
      <Derived>
        <Add>
          <!-- past withholding -->
          <Dependency path="../yearToDateWithholding"/>
          <!-- future withholding, too soon to be changed -->
          <Multiply>
            <Dependency path="../averageWithholdingPerPayPeriod"/>
            <LesserOf>
              <!-- Is the Floor necessary? -->
              <Floor>
                <Dependency path="../remainingPayDates"/>
              </Floor>
              <Dependency path="../payPeriodsBeforeW4ChangesAppear"/>
            </LesserOf>
          </Multiply>
          <!-- future tentative withholding: result from Pub 15-T Worksheet 1A  -->
          <!-- For now, we treat this as a "given" that won't change. Probably will need to revisit
        this when we get to reducing below tentative withholding. -->
          <Multiply>
            <Dependency path="../tentativeWithholdingAmount"/>
            <GreaterOf>
              <Int>0</Int>
              <Subtract>
                <Minuend>
                  <!-- Full pay periods are used here to match QA spreadsheet calculation -->
                  <Floor>
                    <Dependency path="../remainingPayDates"/>
                  </Floor>
                </Minuend>
                <Subtrahends>
                  <Dependency path="../payPeriodsBeforeW4ChangesAppear"/>
                </Subtrahends>
              </Subtract>
            </GreaterOf>
          </Multiply>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/isPayFrequencyWeekly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">weekly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/isPayFrequencyBiWeekly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">biWeekly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/isPayFrequencySemiMonthly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">semiMonthly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/isPayFrequencyMonthly">
      <Derived>
        <Equal>
          <Left>
            <Dependency path="../payFrequency"/>
          </Left>
          <Right>
            <Enum optionsPath="/payFrequencyOptions">monthly</Enum>
          </Right>
        </Equal>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/weeklyRemainingPayDates">
      <Derived>
        <Switch>
          <!-- When the end month is December, and we have days going into the next month -->
          <Case>
            <When>
              <All>
                <Equal>
                  <Left>
                    <Dependency path="../endDate/month"/>
                  </Left>
                  <Right>
                    <Int>12</Int>
                  </Right>
                </Equal>
                <GreaterThan>
                  <Left>
                    <Dependency path="../endDate/day"/>
                  </Left>
                  <Right>
                    <Int>28</Int>
                  </Right>
                </GreaterThan>
              </All>
            </When>
            <Then>
              <Floor>
                <Add>
                  <Divide>
                    <Dividend>
                      <Subtract>
                        <Minuend>
                          <Dependency path="../endDate/ordinal"/>
                        </Minuend>
                        <Subtrahends>
                          <Dependency path="../endDate/day"/>
                          <Dependency path="../mostRecentPayDate/ordinal"/>
                        </Subtrahends>
                      </Subtract>
                    </Dividend>
                    <Divisors>
                      <Dependency path="../payPeriodLength"/>
                    </Divisors>
                  </Divide>
                  <Divide>
                    <Dividend>
                      <Dependency path="../endDate/day"/>
                    </Dividend>
                    <Divisors>
                      <Dependency path="../payPeriodLength"/>
                    </Divisors>
                  </Divide>
                </Add>
              </Floor>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Ceiling>
                <Divide>
                  <Dividend>
                    <Subtract>
                      <Minuend>
                        <Dependency path="../endDate/ordinal"/>
                      </Minuend>
                      <Subtrahends>
                        <Dependency path="../mostRecentPayDate/ordinal"/>
                      </Subtrahends>
                    </Subtract>
                  </Dividend>
                  <Divisors>
                    <Dependency path="../payPeriodLength"/>
                  </Divisors>
                </Divide>
              </Ceiling>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/monthlyRemainingPayDates">
      <Derived>
        <!-- We've already been paid for the most recent pay period month,
           pay periods only need to be calculated for the intermediate and
           last months. -->
        <Add>
          <!-- Add intermediate months -->
          <GreaterOf>
            <Subtract>
              <Minuend>
                <Dependency path="../endDate/month"/>
              </Minuend>
              <Subtrahends>
                <Dependency path="../mostRecentPayDate/month"/>
                <Int>1</Int>
              </Subtrahends>
            </Subtract>
            <Int>0</Int>
          </GreaterOf>
          <!-- Add paydate in final month and final month + 1 if applicable -->
          <Switch>
            <!-- If the most recent pay date and end date are both in December, then there are no
               more applicable pay dates in the current year. -->
            <Case>
              <When>
                <All>
                  <Equal>
                    <Left>
                      <Dependency path="../endDate/month"/>
                    </Left>
                    <Right>
                      <Int>12</Int>
                    </Right>
                  </Equal>
                  <Equal>
                    <Left>
                      <Dependency path="../mostRecentPayDate/month"/>
                    </Left>
                    <Right>
                      <Dependency path="../endDate/month"/>
                    </Right>
                  </Equal>
                </All>
              </When>
              <Then>
                <Int>0</Int>
              </Then>
            </Case>
            <!-- If the end month is in December, then only the pay date in december will apply
          towards
               this tax year. -->
            <Case>
              <When>
                <Equal>
                  <Left>
                    <Dependency path="../endDate/month"/>
                  </Left>
                  <Right>
                    <Int>12</Int>
                  </Right>
                </Equal>
              </When>
              <Then>
                <Int>1</Int>
              </Then>
            </Case>
            <!-- If the start month and end month are equal, then the last pay date will be the next
          month-->
            <Case>
              <When>
                <Equal>
                  <Left>
                    <Dependency path="../mostRecentPayDate/month"/>
                  </Left>
                  <Right>
                    <Dependency path="../endDate/month"/>
                  </Right>
                </Equal>
              </When>
              <Then>
                <Int>1</Int>
              </Then>
            </Case>
            <!-- Otherwise, there will be an applicable paydate in the end month and the next. -->
            <Case>
              <When>
                <True/>
              </When>
              <Then>
                <Int>2</Int>
              </Then>
            </Case>
          </Switch>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/semiMonthlyRemainingPayDates">
      <Derived>
        <!-- Add three numbers:
           remaining pay periods "this" month (if it is not the final month)
           + pay periods for whole months intervening
           + remaining pay periods for final month -->
        <Add>
          <!-- For "this" month (of most recent pay date) ...  -->
          <Switch>
            <Case>
              <When>
                <All>
                  <!-- ... when it's not the final month ...  -->
                  <NotEqual>
                    <Left>
                      <Dependency path="../mostRecentPayDate/month"/>
                    </Left>
                    <Right>
                      <Dependency path="../endDate/month"/>
                    </Right>
                  </NotEqual>
                  <!-- ... and we were last paid in the first half of the month ...  -->
                  <LessThanOrEqual>
                    <Left>
                      <Dependency path="../mostRecentPayDate/day"/>
                    </Left>
                    <Right>
                      <Dependency path="../payPeriodLength"/>
                    </Right>
                  </LessThanOrEqual>
                </All>
              </When>
              <Then>
                <!-- ... then we'll get paid once more this month ...  -->
                <Int>1</Int>
              </Then>
            </Case>
            <Case>
              <When>
                <True/>
              </When>
              <Then>
                <!-- ... otherwise no more this month.  -->
                <Int>0</Int>
              </Then>
            </Case>
          </Switch>
          <!-- For full months between now and end date ...  -->
          <GreaterOf>
            <Int>0</Int>
            <Multiply>
              <!-- ... we get paid twice each.  -->
              <Int>2</Int>
              <Subtract>
                <Minuend>
                  <Dependency path="../endDate/month"/>
                </Minuend>
                <Subtrahends>
                  <Dependency path="../mostRecentPayDate/month"/>
                  <Int>1</Int>
                </Subtrahends>
              </Subtract>
            </Multiply>
          </GreaterOf>
          <!-- For the final month ...  -->
          <Switch>
            <Case>
              <When>
                <!-- ... when we were most recently paid in the final month ... -->
                <Equal>
                  <Left>
                    <Dependency path="../mostRecentPayDate/month"/>
                  </Left>
                  <Right>
                    <Dependency path="../endDate/month"/>
                  </Right>
                </Equal>
              </When>
              <Then>
                <Switch>
                  <Case>
                    <When>
                      <!-- ... and it was for the first half ...  -->
                      <LessThanOrEqual>
                        <Left>
                          <Dependency path="../mostRecentPayDate/day"/>
                        </Left>
                        <Right>
                          <Dependency path="../payPeriodLength"/>
                        </Right>
                      </LessThanOrEqual>
                    </When>
                    <Then>
                      <!-- ... then one payment still remains; ... -->
                      <Int>1</Int>
                    </Then>
                  </Case>
                  <Case>
                    <When>
                      <True/>
                    </When>
                    <Then>
                      <!-- ... otherwise, no payments remain.  -->
                      <Int>0</Int>
                    </Then>
                  </Case>
                </Switch>
              </Then>
            </Case>
            <Case>
              <When>
                <!-- ... otherwise if the first payment pays us through the end date ...   -->
                <LessThanOrEqual>
                  <Left>
                    <Dependency path="../endDate/day"/>
                  </Left>
                  <Right>
                    <Int>15</Int>
                  </Right>
                </LessThanOrEqual>
              </When>
              <Then>
                <!-- ... then that's the only remaining payment; ...  -->
                <Int>1</Int>
              </Then>
            </Case>
            <Case>
              <!-- ... otherwise we're paid twice in the month.  -->
              <When>
                <True/>
              </When>
              <Then>
                <Int>2</Int>
              </Then>
            </Case>
          </Switch>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/remainingPayDates">
      <Description>
      The number of pay dates remaining for this pension that will be paid out within the calendar
      year.
    </Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Any>
                <Dependency path="../isPayFrequencyWeekly"/>
                <Dependency path="../isPayFrequencyBiWeekly"/>
              </Any>
            </When>
            <Then>
              <Dependency path="../weeklyRemainingPayDates"/>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencyMonthly"/>
            </When>
            <Then>
              <Dependency path="../monthlyRemainingPayDates"/>
            </Then>
          </Case>
          <Case>
            <When>
              <Dependency path="../isPayFrequencySemiMonthly"/>
            </When>
            <Then>
              <Dependency path="../semiMonthlyRemainingPayDates"/>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/restOfYearIncome">
      <Derived>
        <Multiply>
          <Dependency path="../averagePayPerPayPeriod"/>
          <Dependency path="../remainingPayDates"/>
        </Multiply>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/endOfYearProjectedWithholding">
      <Derived>
        <Add>
          <Dependency path="../yearToDateWithholding"/>
          <Multiply>
            <!-- Floor is used here to match QA spreadsheet calculation -->
            <Floor>
              <Dependency path="../remainingPayDates"/>
            </Floor>
            <Dependency path="../averageWithholdingPerPayPeriod"/>
          </Multiply>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/pensions/*/w4pLine4cRecommendation">
      <!--      TODO: fix up this computation, not producing correct results-->
      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path=".."/>
                </Left>
                <Right>
                  <Dependency path="/pensionSelectedForExtraWithholding"/>
                </Right>
              </Equal>
            </When>
            <Then>
              <GreaterOf>
                <Round>
                  <Divide>
                    <Dividend>
                      <Subtract>
                        <Minuend>
                          <Dependency path="/totalTax"/>
                        </Minuend>
                        <Subtrahends>
                          <Dependency path="/totalCommittedWithholding"/>
                        </Subtrahends>
                      </Subtract>
                    </Dividend>
                    <Divisors>
                      <Subtract>
                        <Minuend>
                          <Dependency path="../remainingPayDates"/>
                        </Minuend>
                        <Subtrahends>
                          <Dependency path="../payPeriodsBeforeW4ChangesAppear"/>
                        </Subtrahends>
                      </Subtract>
                    </Divisors>
                  </Divide>
                </Round>
                <Dollar>0</Dollar>
              </GreaterOf>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensionsAvailableForExtraWithholding">
      <Derived>
        <Filter path="/pensions">
          <GreaterThan>
            <Left>
              <Dependency path="/pensions/*/remainingPayDates"/>
            </Left>
            <Right>
              <Dependency path="/pensions/*/payPeriodsBeforeW4ChangesAppear"/>
            </Right>
          </GreaterThan>
        </Filter>
      </Derived>
    </Fact>
    <Fact path="/pensionSelectedForExtraWithholding">
      <Description>
      Logic dictating which pension will be assigned additional or reduced withholding.
      If there are any jobs, then those will be assigned the withholding modifications and
      pensions will remain untouched.
    </Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <CollectionSize>
                    <Dependency path="/jobs"/>
                  </CollectionSize>
                </Left>
                <Right>
                  <Int>0</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <IndexOf>
                <Collection>
                  <Filter path="/pensionsAvailableForExtraWithholding">
                    <Equal>
                      <Left>
                        <Maximum>
                          <Dependency path="/pensionsAvailableForExtraWithholding/*/restOfYearIncome"/>
                        </Maximum>
                      </Left>
                      <Right>
                        <Dependency path="restOfYearIncome"/>
                      </Right>
                    </Equal>
                  </Filter>
                </Collection>
                <Index>
                  <Int>0</Int>
                </Index>
              </IndexOf>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pensionsTotalEndOfYearProjectedWithholding">
      <Derived>
        <CollectionSum>
          <Dependency path="/pensions/*/endOfYearProjectedWithholding"/>
        </CollectionSum>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
