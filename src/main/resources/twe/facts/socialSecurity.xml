<?xml version="1.0"?>
<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/socialSecuritySources">
      <Writable>
        <Collection/>
      </Writable>
    </Fact>
    <Fact path="/socialSecuritySources/*/isAllYear">
      <Writable>
        <Boolean/>
      </Writable>
    </Fact>
    <Fact path="/socialSecuritySources/*/filerAssignment">
      <Description>Whether this is attributed to the primary filer or spouse if MFJ</Description>
      <Override>
        <Condition>
          <Not>
            <Dependency path="/isFilingStatusMFJ"/>
          </Not>
        </Condition>
        <Default>
          <Enum optionsPath="/filerAssignmentOption">self</Enum>
        </Default>
      </Override>
      <Writable>
        <Enum optionsPath="/filerAssignmentOption"/>
      </Writable>
    </Fact>
    <Fact path="/socialSecuritySources/*/notSpouses">
      <Description>The income doesn't belong to the spouse</Description>
      <Derived>
        <Any>
          <Not>
            <IsComplete>
              <Dependency path="../filerAssignment"/>
            </IsComplete>
          </Not>
          <NotEqual>
            <Left>
              <Dependency path="../filerAssignment"/>
            </Left>
            <Right>
              <Enum optionsPath="/filerAssignmentOption">spouse</Enum>
            </Right>
          </NotEqual>
        </Any>
      </Derived>
    </Fact>
    <Fact path="/socialSecuritySources/*/flowIsAllYearComplete">
      <Derived>
        <IsComplete>
          <Dependency path="../isAllYear"/>
        </IsComplete>
      </Derived>
    </Fact>
    <Fact path="/socialSecuritySources/*/startDate">
      <Override>
        <Condition>
          <Dependency path="../isAllYear"/>
        </Condition>
        <Default>
          <Dependency path="/yearStartDate"/>
        </Default>
      </Override>
      <Writable>
        <Day/>
        <Limit type="Max">
          <Dependency path="/yearEndDate"/>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/socialSecuritySources/*/endDate">
      <Override>
        <Condition>
          <Dependency path="../isAllYear"/>
        </Condition>
        <Default>
          <Dependency path="/yearEndDate"/>
        </Default>
      </Override>
      <Writable>
        <Day/>
        <Limit type="Max">
          <Dependency path="/yearEndDate"/>
        </Limit>
      </Writable>
    </Fact>
    <Fact path="/socialSecuritySources/*/monthlyIncome">
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/socialSecurityWithheldTaxesOptions">
      <Description>Options for social security federal taxes withheld</Description>
      <Derived>
        <EnumOptions>
          <String>zero</String>
          <String>seven</String>
          <String>ten</String>
          <String>twelve</String>
          <String>twentyTwo</String>
        </EnumOptions>
      </Derived>
    </Fact>
    <Fact path="/socialSecuritySources/*/withheldRate">
      <Description>The rate at which taxes are withheld</Description>
      <Writable>
        <Enum optionsPath="/socialSecurityWithheldTaxesOptions"/>
      </Writable>
    </Fact>
    <Fact path="/socialSecuritySources/*/withheldRateAsRationale">
      <Description>The rate at which taxes are withheld as a rationale</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="../withheldRate"/>
                </Left>
                <Right>
                  <Enum optionsPath="/socialSecurityWithheldTaxesOptions">zero</Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Rational>0/1</Rational>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="../withheldRate"/>
                </Left>
                <Right>
                  <Enum optionsPath="/socialSecurityWithheldTaxesOptions">seven</Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Rational>7/100</Rational>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="../withheldRate"/>
                </Left>
                <Right>
                  <Enum optionsPath="/socialSecurityWithheldTaxesOptions">ten</Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Rational>1/10</Rational>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="../withheldRate"/>
                </Left>
                <Right>
                  <Enum optionsPath="/socialSecurityWithheldTaxesOptions">twelve</Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Rational>3/25</Rational>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="../withheldRate"/>
                </Left>
                <Right>
                  <Enum optionsPath="/socialSecurityWithheldTaxesOptions">twentyTwo</Enum>
                </Right>
              </Equal>
            </When>
            <Then>
              <Rational>11/50</Rational>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/socialSecuritySources/*/hasEnded">
      <Description>If the social secuirty source has already ended or ended today</Description>
      <Derived>
        <GreaterThanOrEqual>
          <Left>
            <Dependency path="/today"/>
          </Left>
          <Right>
            <Dependency path="../endDate"/>
          </Right>
        </GreaterThanOrEqual>
      </Derived>
    </Fact>
    <Fact path="/socialSecuritySources/*/isFutureOrUnknown">
      <Description>Whether the social security income is still continues into the future or we don't know yet</Description>
      <Derived>
        <Any>
          <Not>
            <IsComplete>
              <Dependency path="../endDate"/>
            </IsComplete>
          </Not>
          <Not>
            <Dependency path="../hasEnded"/>
          </Not>
        </Any>
      </Derived>
    </Fact>
    <Fact path="/socialSecuritySources/*/totalIncome">
      <Derived>
        <Multiply>
          <Dependency path="../monthlyIncome"/>
          <PayrollMonthsBetween>
            <StartDate>
              <Dependency path="../startDate"/>
            </StartDate>
            <EndDate>
              <Dependency path="../endDate"/>
            </EndDate>
          </PayrollMonthsBetween>
        </Multiply>
      </Derived>
    </Fact>
    <Fact path="/socialSecuritySources/*/totalFederalTaxesPaid">
      <Derived>
        <Multiply>
          <Dependency path="../withheldRateAsRationale"/>
          <Dependency path="../totalIncome"/>
        </Multiply>
      </Derived>
    </Fact>
    <Fact path="/socialSecurityBenefitsIncome">
      <Description>Gross SSA Income from forms SSA-1099 and RRB-1099</Description>
      <Derived>
        <CollectionSum>
          <Dependency path="/socialSecuritySources/*/totalIncome"/>
        </CollectionSum>
      </Derived>
    </Fact>
    <Fact path="/totalTaxesPaidOnSocialSecurityIncome">
      <Derived>
        <CollectionSum>
          <Dependency path="/socialSecuritySources/*/totalFederalTaxesPaid"/>
        </CollectionSum>
      </Derived>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/netSocialSecurityBenefitsIncome">
      <Derived>
        <Subtract>
          <Minuend>
            <Dependency path="/socialSecurityBenefitsIncome"/>
          </Minuend>
          <Subtrahends>
            <Dependency path="/totalTaxesPaidOnSocialSecurityIncome"/>
          </Subtrahends>
        </Subtract>
      </Derived>
    </Fact>
    <Fact path="/pub915Worksheet1Line1">
      <Description>Total amount from box 5 of ALL your Forms SSA-1099 and RRB-1099. Form 1040 line 6a. Pub 915 Worksheet 1, Line 1.</Description>
      <Derived>
        <Dependency path="/netSocialSecurityBenefitsIncome"/>
      </Derived>
    </Fact>
    <Fact path="/pub915Worksheet1Line2">
      <Description> Pub 915 Worksheet 1, Line 2. </Description>
      <Derived>
        <Multiply>
          <Dependency path="/pub915Worksheet1Line1"/>
          <Rational>50/100</Rational>
        </Multiply>
      </Derived>
    </Fact>
    <Fact path="/pub915Worksheet1Line3">
      <Description> Pub 915 Worksheet 1, Line 3. Combine the amounts from Form 1040 or 1040 SR lines 1z, 2b, 3b, 4b, 5b, 7, and 8'.
                  This includes job wages, tips, Medicaid waiver payments, taxable dependent care benefits,
                  employer-provided adoption benefits,
                  taxable interest (2b), ordinary dividends (3b), IRA distributions taxable amounts (4b), pensions
                  and annuities taxable amount (5b),
                  capital gain or loss (7), additional income from Schedule 1 line 10 (8) </Description>
      <Derived>
        <Dependency path="/incomeTotalMinusTaxableSSABenefits"/>
      </Derived>
    </Fact>
    <Fact path="/pub915Worksheet1Line4">
      <Description> Pub 915 Worksheet 1, Line 4. Enter the amount from Form 1040 or Form 1040-SR 2a. Non-taxable
        interest income, such as interest on municipal bonds</Description>
      <Derived>
        <Dependency path="/taxExemptInterestIncome"/>
      </Derived>
    </Fact>
    <Fact path="/pub915Worksheet1Line5">
      <Description> Pub 915 Worksheet 1, Line 5. Enter the total of any exclusions/adjustments for: &#x2022; Adoption benefits (Form 8839, line 30), &#x2022; Foreign earned income or housing (Form 2555, lines 45 and 50), and &#x2022; Certain income of bona fide residents of American Samoa (Form 4563, line 15) or Puerto Rico</Description>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>
    <Fact path="/pub915Worksheet1Line6">
      <Description> Pub 915 Worksheet 1, Line 6.</Description>
      <Derived>
        <Round>
          <Add>
            <Dependency path="/pub915Worksheet1Line2"/>
            <Dependency path="/pub915Worksheet1Line3"/>
            <Dependency path="/pub915Worksheet1Line4"/>
            <Dependency path="/pub915Worksheet1Line5"/>
          </Add>
        </Round>
      </Derived>
    </Fact>
    <Fact path="/pub915Worksheet1Line7">
      <Description>Sum of adjustments from Form 1044 Schedule 1. Student loan interest deduction
        should not be included. IRS Pub 915 Worksheet 1, Line 7.
      </Description>
      <Derived>
        <Dependency path="/adjustmentsToIncomeExcludingStudentLoanInterest"/>
      </Derived>
    </Fact>
    <Fact path="/pub915MAGIForBenefitsTaxableAmountLine8">
      <Description>Modifed AGI used to determine taxable amount of SSA benefits. IRS Pub 915
        Worksheet 1, Line 8.
      </Description>
      <Derived>
        <GreaterOf>
          <Dollar>0</Dollar>
          <Subtract>
            <Minuend>
              <Dependency path="/pub915Worksheet1Line6"/>
            </Minuend>
            <Subtrahends>
              <Dependency path="/pub915Worksheet1Line7"/>
            </Subtrahends>
          </Subtract>
        </GreaterOf>
      </Derived>
    </Fact>
    <Fact path="/pub915BracketZeroLine9">
      <Description>Threshold when taxable portion of SSA Benefits changes from 0% to 50%. Pub 915
        Worksheet 1, Line 9.
        If SSA MAGI (Line 8) is less than $32K for MFJ and $25K for anybody else, 0% of SSA benefits
        are taxed. This is our bracket zero.
        Taxable portion of SSA MAGI which is more than bracket zero but less than $32K + $12K for
        MFJ and $25K + $9K for everyone else, is 50%, not to exceed 50% of SSA Benefits total.
        Taxable portion of SSA MAGI which is more than $32K + $12K for MFJ and $25K + $9K for
        everyone else, is 85%, not to exceed 85% of SSA Benefits total.
        If TP is MFS which lived together for any part of the year, all SSA Benefits are taxed at
        85%.
      </Description>
      <Derived>
        <Switch>
          <!-- MFJ -->
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dollar>32000</Dollar>
            </Then>
          </Case>
          <!-- MFS who lived together-->
          <Case>
            <When>
              <All>
                <Dependency path="/isMFSLivedTogether"/>
                <Dependency path="/isFilingStatusMFS"/>
              </All>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>25000</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pub915IncomeExceedingBracketZeroLine10">
      <Description>MAGI which exceeds zero threshold. Pub 915 Worksheet 1, Line 10</Description>
      <Derived>
        <GreaterOf>
          <Dollar>0</Dollar>
          <Subtract>
            <Minuend>
              <Dependency path="/pub915MAGIForBenefitsTaxableAmountLine8"/>
            </Minuend>
            <Subtrahends>
              <Dependency path="/pub915BracketZeroLine9"/>
            </Subtrahends>
          </Subtract>
        </GreaterOf>
      </Derived>
    </Fact>
    <Fact path="/pub915Bracket50Line11">
      <Description>Income bracket where taxable portion is 50%. Pub 915 Worksheet 1, Line 11</Description>
      <Derived>
        <Switch>
          <!-- MFJ -->
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dollar>12000</Dollar>
            </Then>
          </Case>
          <!-- MFS who lived together-->
          <Case>
            <When>
              <All>
                <Dependency path="/isMFSLivedTogether"/>
                <Dependency path="/isFilingStatusMFS"/>
              </All>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>9000</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pub915IncomeTaxableAt50Line13">
      <Description>Amount of MAGI with taxable portion 50%. Pub 915 Worksheet 1, Line 13</Description>
      <Derived>
        <LesserOf>
          <!-- 50% bracket -->
          <Dependency path="/pub915Bracket50Line11"/>
          <!-- MAGI minus minimum threshold. Line 10 of Pub 915-->
          <Dependency path="/pub915IncomeExceedingBracketZeroLine10"/>
        </LesserOf>
      </Derived>
    </Fact>
    <Fact path="/pub915TaxablePortionFor50Line15">
      <Description>Taxable amount for 50% bracket. Should not exceed 50% of total SSA Benefits. Pub
        915 Worksheet 1, Line 15</Description>
      <Derived>
        <LesserOf>
          <!-- 50% of total SSA Benefits. Pub 915 Line 2-->
          <Multiply>
            <Dependency path="/socialSecurityBenefitsIncome"/>
            <Rational>50/100</Rational>
          </Multiply>
          <!-- 50% of MAGI within the bracket  -->
          <Multiply>
            <Dependency path="/pub915IncomeTaxableAt50Line13"/>
            <Rational>50/100</Rational>
          </Multiply>
        </LesserOf>
      </Derived>
    </Fact>
    <Fact path="/line16Pub915TaxablePortionFor85">
      <Description>Taxable amount for 85% bracket. Pub 915 Worksheet 1, Line 16</Description>
      <Derived>
        <Multiply>
          <GreaterOf>
            <Dollar>0</Dollar>
            <!-- Pub 915 Line 12: income exceeding 50% bracket:  -->
            <Subtract>
              <Minuend>
                <!-- Line 10. MAGI over zero threshold-->
                <Dependency path="/pub915IncomeExceedingBracketZeroLine10"/>
              </Minuend>
              <Subtrahends>
                <!-- Line 11. 50% bracket-->
                <Dependency path="/pub915Bracket50Line11"/>
              </Subtrahends>
            </Subtract>
          </GreaterOf>
          <Rational>85/100</Rational>
        </Multiply>
      </Derived>
    </Fact>
    <Fact path="/ssaBenefitsTaxableAmount">
      <Description>Taxable amount of Social Security benefits to enter in Form 1040 line 6b. Ranges
        from 0% to up to 50% to up to 85% of total SSA benefits</Description>
      <Derived>
        <LesserOf>
          <Add>
            <Dependency path="/pub915TaxablePortionFor50Line15"/>
            <Dependency path="/line16Pub915TaxablePortionFor85"/>
          </Add>
          <Multiply>
            <Dependency path="/socialSecurityBenefitsIncome"/>
            <Rational>85/100</Rational>
          </Multiply>
        </LesserOf>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
