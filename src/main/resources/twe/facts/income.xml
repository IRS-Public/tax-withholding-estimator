<?xml version="1.0"?>
<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/declaredDoneAddingIncome">
      <Description>Whether the taxpayer has declared they are done adding new income</Description>
      <Writable>
        <Boolean/>
      </Writable>
    </Fact>
    <!-- This is a temporary definition, kind of circular with other facts. -->
    <Fact path="/ordinaryDividendsIncome">
      <Description>Ordinary dividends income</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/unemploymentInsuranceIncome">
      <Description>Unemployment insurance income</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/interestExcludingNonTaxableIncome">
      <Description>Interest income excluding non-taxable interest</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/shortTermCapitalGainsIncome">
      <Description>Short term capital gains income</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/longTermCapitalGainsIncome">
      <Description>Long term capital gains income</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/qualifiedDividendsIncome">
      <Description>Amount of qualified dividends estimated by tax payer.</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/taxableScholarshipIncome">
      <Description>Taxable income from scholarships</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/alimonyReceivedIncome">
      <Description>Alimony received income</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/sCorpNonPassiveIncome">
      <Description>S-corp non-passive income (Schedule K1)</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/netScheduleEIncome">
      <Description>Net Schedule E income</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/nonSpecificOtherIncome">
      <Description>Non-specific other income</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/socialSecurityBenefitsIncome">
      <Description>SSA Income from forms SSA-1099 and RRB-1099</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/nonTaxableInterestIncome">
      <Description>Non-taxable interest income. Used to calculate modified AGI for calculating
        taxable amount of SSA benefits</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <Fact path="/isMFSLivedTogether">
      <Description>If TP has MFS filing status and lived with their spouse at any time during the TY</Description>
      <Writable>
        <Boolean/>
      </Writable>
    </Fact>
    <Fact path="/pub915MAGIForBenefitsTaxableAmountLine7">
      <Description>Sum of adjustments from Form 1044 Schedule 1. Student loan interest deduction
        should not be included. IRS Pub 915 Worksheet 1, Line 7.
      </Description>
      <Derived>
        <Dependency path="/adjustmentsToIncomeExcludingStudentLoanInterest"/>
      </Derived>
    </Fact>
    <Fact path="/pub915MAGIForBenefitsTaxableAmountLine8">
      <Description>Modifed AGI used to determine taxable amount of SSA benefits. IRS Pub 915
        Worksheet 1, Line 8.
      </Description>
      <Derived>
        <GreaterOf>
          <Dollar>0</Dollar>
          <Subtract>
            <!-- Line 6. Sum of incomes received-->
            <Minuend>
              <Round>
                <Add>
                  <!-- Line 2. Half of the total SSA benefits received -->
                  <Multiply>
                    <!-- Line 1. Total amount of SSA benefits received, from all forms SSA-1099 and
                    RRB-1099 -->
                    <Dependency path="/socialSecurityBenefitsIncome"/>
                    <Rational>50/100</Rational>
                  </Multiply>
                  <!-- Line 3. 'Combine the amounts from Form 1040 or 1040 SR lines 1z, 2b, 3b, 4b,
                  5b, 7, and 8'.
                  This includes job wages, tips, Medicaid waiver payments, taxable dependent care benefits,
                  employer-provided adoption benefits,
                  taxable interest (2b), ordinary dividends (3b), IRA distributions taxable amounts (4b), pensions
                  and annuities taxable amount (5b),
                  capital gain or loss (7), additional income from Schedule 1 line 10 (8)  -->
                  <Dependency path="/totalOtherIncomeWithoutSSABenefitsTaxableAmount"/>
                  <!-- Line 4. Enter the amount from Form 1040 or Form 1040-SR 2a. Non-taxable
                  interest income, such as interest on municipal bonds -->
                  <Dependency path="/nonTaxableInterestIncome"/>
                  <!-- Line 5. Adoption benefits, Foreign earned income or housing, certain income
                  of bona fide residents of Puerto Rico or American Samoa
                  NOTE: those income streams are not currently captured by TWE, and also could become a part of
                  /totalOtherIncomeWithoutSSABenefitsTaxableAmount -->
                </Add>
              </Round>
            </Minuend>
            <!-- Line 7. Adjustments to income, excluding Student Loan Interest-->
            <Subtrahends>
              <Dependency path="/pub915MAGIForBenefitsTaxableAmountLine7"/>
            </Subtrahends>
          </Subtract>
        </GreaterOf>
      </Derived>
    </Fact>
    <Fact path="/pub915BracketZeroLine9">
      <Description>Threshold when taxable portion of SSA Benefits changes from 0% to 50%. Pub 915
        Worksheet 1, Line 9.
        If SSA MAGI (Line 8) is less than $32K for MFJ and $25K for anybody else, 0% of SSA benefits
        are taxed. This is our bracket zero.
        Taxable portion of SSA MAGI which is more than bracket zero but less than $32K + $12K for
        MFJ and $25K + $9K for evereryone else, is 50%, not to exceed 50% of SSA Benefits total.
        Taxable portion of SSA MAGI which is more than $32K + $12K for MFJ and $25K + $9K for
        evereryone else, is 85%, not to exceed 85% of SSA Benefits total.
        If TP is MFS which lived together for any part of the year, all SSA Benefits are taxed at
        85%.
      </Description>
      <Derived>
        <Switch>
          <!-- MFJ -->
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dollar>32000</Dollar>
            </Then>
          </Case>
          <!-- MFS who lived together-->
          <Case>
            <When>
              <All>
                <Dependency path="/isMFSLivedTogether"/>
                <Dependency module="filingStatus" path="/isFilingStatusMFS"/>
              </All>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>25000</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pub915IncomeExceedingBracketZeroLine10">
      <Description>MAGI which exceeds zero threshold. Pub 915 Worksheet 1, Line 10</Description>
      <Derived>
        <GreaterOf>
          <Dollar>0</Dollar>
          <Subtract>
            <Minuend>
              <Dependency path="/pub915MAGIForBenefitsTaxableAmountLine8"/>
            </Minuend>
            <Subtrahends>
              <Dependency path="/pub915BracketZeroLine9"/>
            </Subtrahends>
          </Subtract>
        </GreaterOf>
      </Derived>
    </Fact>
    <Fact path="/pub915Bracket50Line11">
      <Description>Income bracket where taxable portion is 50%. Pub 915 Worksheet 1, Line 11</Description>
      <Derived>
        <Switch>
          <!-- MFJ -->
          <Case>
            <When>
              <Dependency module="filingStatus" path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Dollar>12000</Dollar>
            </Then>
          </Case>
          <!-- MFS who lived together-->
          <Case>
            <When>
              <All>
                <Dependency path="/isMFSLivedTogether"/>
                <Dependency module="filingStatus" path="/isFilingStatusMFS"/>
              </All>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>9000</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/pub915IncomeTaxableAt50Line13">
      <Description>Amount of MAGI with taxable portion 50%. Pub 915 Worksheet 1, Line 13</Description>
      <Derived>
        <LesserOf>
          <!-- 50% bracket -->
          <Dependency path="/pub915Bracket50Line11"/>
          <!-- MAGI minus minimum threshold. Line 10 of Pub 915-->
          <Dependency path="/pub915IncomeExceedingBracketZeroLine10"/>
        </LesserOf>
      </Derived>
    </Fact>
    <Fact path="/pub915TaxablePortionFor50Line15">
      <Description>Taxable amount for 50% bracket. Should not exceed 50% of total SSA Benefits. Pub
        915 Worksheet 1, Line 15</Description>
      <Derived>
        <LesserOf>
          <!-- 50% of total SSA Benefits. Pub 915 Line 2-->
          <Multiply>
            <Dependency path="/socialSecurityBenefitsIncome"/>
            <Rational>50/100</Rational>
          </Multiply>
          <!-- 50% of MAGI within the bracket  -->
          <Multiply>
            <Dependency path="/pub915IncomeTaxableAt50Line13"/>
            <Rational>50/100</Rational>
          </Multiply>
        </LesserOf>
      </Derived>
    </Fact>
    <Fact path="/line16Pub915TaxablePortionFor85">
      <Description>Taxable amount for 85% bracket. Pub 915 Worksheet 1, Line 16</Description>
      <Derived>
        <Multiply>
          <GreaterOf>
            <Dollar>0</Dollar>
            <!-- Pub 915 Line 12: income exceeding 50% bracket:  -->
            <Subtract>
              <Minuend>
                <!-- Line 10. MAGI over zero threshold-->
                <Dependency path="/pub915IncomeExceedingBracketZeroLine10"/>
              </Minuend>
              <Subtrahends>
                <!-- Line 11. 50% bracket-->
                <Dependency path="/pub915Bracket50Line11"/>
              </Subtrahends>
            </Subtract>
          </GreaterOf>
          <Rational>85/100</Rational>
        </Multiply>
      </Derived>
    </Fact>
    <Fact path="/ssaBenefitsTaxableAmount">
      <Description>Taxable amount of Social Security benefits to enter in Form 1040 line 6b. Ranges
        from 0% to up to 50% to up to 85% of total SSA benefits</Description>
      <Derived>
        <LesserOf>
          <Add>
            <Dependency path="/pub915TaxablePortionFor50Line15"/>
            <Dependency path="/line16Pub915TaxablePortionFor85"/>
          </Add>
          <Multiply>
            <Dependency path="/socialSecurityBenefitsIncome"/>
            <Rational>85/100</Rational>
          </Multiply>
        </LesserOf>
      </Derived>
    </Fact>
    <Fact path="/trumpAccountDistribution">
      <Name>OB3 70204: Distribution from Trump Account as defined by IRC 530A</Name>
      <Description> The term "Trump account" means an individual retirement account (as defined in
        section 408(a)) which is not
        designated as a Roth IRA and which meets certain investment requirements</Description>
      <Writable>
        <Dollar/>
      </Writable>
    </Fact>
    <!-- Sections 911, 931, and 933 are carved out for OB3 MAGI calculations for senior deduction
and car loan interest deduction
     Default to 0 for right now-->
    <Fact path="/foreignEarnedIncome">
      <Name>&#xA7; 911 Foreign Earned Income Exclusion- Foreign Earned Income</Name>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>
    <Fact path="/overseasTerritoryIncome">
      <Name>&#xA7; 931 - Income from sources within Guam, American Samoa, or the Northern Mariana
        Islands
      </Name>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>
    <Fact path="/puertoRicoEarnedIncome">
      <Name>&#xA7; 933. Income from sources within Puerto Rico</Name>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>
    <Fact path="/nonTaxableCombatPay">
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>
    <Fact path="/qualifiedTipIncome">
      <Name>Qualified Tip Income</Name>
      <Description>OB3 &#xA7;70201; IRC &#xA7;224. Qualified tip income</Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/overtimeCompensationExcludingQualifiedTipsOvertimeComp">
      <Name>Overtime Compensation Excluding Qualified Tip Overtime Comp</Name>
      <Description>OB3 &#xA7;70202 IRC &#xA7;225(c)(2). Overtime compensation excluding all
        qualified tips
        defined
        in IRC &#xA7;224 that were received as part of qualified overtime compensation</Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/incomeToIncludeForOB3MAGI">
      <Derived>
        <Add>
          <Dependency path="/foreignEarnedIncome"/>
          <Dependency path="/overseasTerritoryIncome"/>
          <Dependency path="/puertoRicoEarnedIncome"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/grossSelfEmploymentIncomeSelf">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/grossSelfEmploymentIncomeSpouse">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/selfEmploymentIncomeExpensesSelf">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/selfEmploymentIncomeExpensesSpouse">
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/totalPensionsIncome">
      <Description> Total income from all pensions. </Description>
      <Derived>
        <CollectionSum>
          <Dependency path="/pensions/*/income"/>
        </CollectionSum>
      </Derived>
    </Fact>
    <Fact path="/totalJobsIncome">
      <Description>Total income for all jobs</Description>
      <Derived>
        <CollectionSum>
          <Dependency path="/jobs/*/income"/>
        </CollectionSum>
      </Derived>
    </Fact>
    <Fact path="/totalJobsIncomeSpouse">
      <Description>PLACEHOLDER for Total income for all jobs for spouse</Description>
      <Derived>
        <Dollar>0</Dollar>
      </Derived>
    </Fact>
    <Fact path="/totalJobsIncomeSelfAndSpouse">
      <Description>PLACEHOLDER for Total income for all jobs for spouse</Description>
      <Derived>
        <Add>
          <Dependency path="/totalJobsIncome"/>
          <Dependency path="/totalJobsIncomeSpouse"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/totalNonJobsIncome">
      <Derived>
        <GreaterOf>
          <Dollar>0</Dollar>
          <Subtract>
            <Minuend>
              <Dependency path="/totalIncome"/>
            </Minuend>
            <Subtrahends>
              <Dependency path="/totalJobsIncome"/>
              <Dependency path="/netSelfEmploymentIncomeSelf"/>
            </Subtrahends>
          </Subtract>
        </GreaterOf>
      </Derived>
    </Fact>
    <Fact path="/netSelfEmploymentIncomeTotal">
      <Derived>
        <Add>
          <Dependency path="/netSelfEmploymentIncomeSelf"/>
          <Dependency path="/netSelfEmploymentIncomeSpouse"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/earnedIncomeSelf">
      <!--      TODO: break this out between self and spouse-->
      <Description>
        Earned Income includes:
          Wages, salary, or tips where federal income taxes are withheld on Form W-2, box 1
          Income from a job where your employer didn&#x2019;t withhold tax (such as gig economy work) including:
            Driving a car for booked rides or deliveries
            Running errands or doing tasks
            Selling goods online
            Providing creative or professional services
            Providing other temporary, on-demand or freelance work
          Money made from self-employment, including if you:
            Own or operate a business or farm
            Are a minister or member of a religious order
            Are a statutory employee and have income
          Benefits from a union strike
          Certain disability benefits you got before you were the minimum retirement age
          Nontaxable Combat Pay (Form W-2, box 12 with code Q)

        Earned income does not include:
          Pay you got for work when you were an inmate in a penal institution
          Interest and dividends
          Pensions or annuities
          Social Security
          Unemployment benefits
          Alimony
          Child support


      </Description>
      <Derived>
        <Add>
          <Dependency path="/netSelfEmploymentIncomeSelf"/>
          <Dependency path="/totalJobsIncome"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/earnedIncomeSpouse">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/isFilingStatusMFJ"/>
            </When>
            <Then>
              <Add>
                <Dependency path="/netSelfEmploymentIncomeSpouse"/>
                <Dependency path="/totalJobsIncomeSpouse"/>
              </Add>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/earnedIncomeTotal">
      <Derived>
        <Add>
          <Dependency path="/earnedIncomeSelf"/>
          <Dependency path="/earnedIncomeSpouse"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/totalOtherIncomeWithoutSSABenefitsTaxableAmount">
      <Description> Other sources of income. Taxable portion of SSA benefits not included. Used to
        calculate taxable portion onf SSA benefits</Description>
      <Derived>
        <Add>
          <Dependency path="/ordinaryDividendsIncome"/>
          <Dependency path="/unemploymentInsuranceIncome"/>
          <Dependency path="/interestExcludingNonTaxableIncome"/>
          <Dependency path="/shortTermCapitalGainsIncome"/>
          <Dependency path="/longTermCapitalGainsIncome"/>
          <Dependency path="/taxableScholarshipIncome"/>
          <Dependency path="/alimonyReceivedIncome"/>
          <Dependency path="/sCorpNonPassiveIncome"/>
          <Dependency path="/netScheduleEIncome"/>
          <Dependency path="/nonSpecificOtherIncome"/>
          <Dependency path="/trumpAccountDistribution"/>
          <!--          TODO: when splitting out self and spouse collections, remove spouse here-->
          <Dependency path="/scheduleSELine10Self"/>
          <Dependency path="/scheduleSELine10Spouse"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/totalOtherIncome">
      <Derived>
        <Add>
          <Dependency path="/totalOtherIncomeWithoutSSABenefitsTaxableAmount"/>
          <Dependency path="/ssaBenefitsTaxableAmount"/>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/totalIncome">
      <Derived>
        <Round>
          <Add>
            <Dependency path="/totalJobsIncome"/>
            <Dependency path="/totalPensionsIncome"/>
            <Dependency path="/totalOtherIncome"/>
            <Dependency path="/netSelfEmploymentIncomeTotal"/>
          </Add>
        </Round>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
