<?xml version="1.0"?>
<?xml-model href="./FactDictionaryModule.rng"?>
<FactDictionaryModule>
  <Facts>
    <Fact path="/primaryFilerIsClaimingEdc">
      <Writable>
        <Boolean/>
      </Writable>
      <Placeholder>
        <False/>
      </Placeholder>
    </Fact>
    <Fact path="/secondaryFilerIsClaimingEdc">
      <Writable>
        <Boolean/>
      </Writable>
      <Placeholder>
        <False/>
      </Placeholder>
    </Fact>
    <Fact path="/numberOfEdcQualifyingTaxpayers">
      <Derived>
        <Add>
          <Count>
            <Dependency path="/primaryFilerIsClaimingEdc"/>
          </Count>
          <Count>
            <Dependency path="/secondaryFilerIsClaimingEdc"/>
          </Count>
        </Add>
      </Derived>
    </Fact>
    <Fact path="/isTentativelyEligibleForEdc">
      <Description>Used in the flow if the taxpayer(s) *could* be eligible for EDC (We don't know for sure for MFJ filers at this point)</Description>
      <Derived>
        <Any>
          <!-- MFJ, tentative -->
          <Dependency path="/isTentativelyEligibleForEdcMFJ"/>
          <Dependency path="/isEligbleForEdcMFS"/>
          <Dependency path="/isEligbleForEdcSingle"/>
        </Any>
      </Derived>
    </Fact>
    <Fact path="/isEligibleForEdc">
      <Description>Used in calculations to determine if the taxpayer(s) is/are actually eligible for EDC</Description>
      <Derived>
        <Any>
          <!-- MFJ, actually known -->
          <Dependency path="/isEligbleForEdcMFJ"/>
          <Dependency path="/isEligbleForEdcMFS"/>
          <Dependency path="/isEligbleForEdcSingle"/>
        </Any>
      </Derived>
    </Fact>
    <Fact path="/isTentativelyEligibleForEdcMFJ">
      <Description>
        Used in the flow if the taxpayer(s) *could* be eligible for EDC depending on how many taxpayers certify that they are qualified.
        We use the higher of the MFJ limits at this stage until we know how many filers are actually qualified.
      </Description>
      <Derived>
        <All>
          <Dependency path="/isFilingStatusMFJ"/>
          <LessThan>
            <Left>
              <Dependency path="/agi"/>
            </Left>
            <Right>
              <Dependency path="/edcAgiThresholdMFJBothQualified"/>
            </Right>
          </LessThan>
          <!-- TODO: nontaxable income below "both qualified" threshold-->
        </All>
      </Derived>
    </Fact>
    <Fact path="/isEligbleForEdcMFJ">
      <Derived>
        <All>
          <Dependency path="/isFilingStatusMFJ"/>
          <LessThan>
            <Left>
              <Dependency path="/agi"/>
            </Left>
            <Right>
              <Dependency path="/edcAgiThresholdMFJ"/>
            </Right>
          </LessThan>
          <!-- TODO: check for nontaxable income below corresponding threshold-->
        </All>
      </Derived>
    </Fact>
    <Fact path="/isEligbleForEdcMFS">
      <Derived>
        <All>
          <Dependency path="/isFilingStatusMFS"/>
          <LessThan>
            <Left>
              <Dependency path="/agi"/>
            </Left>
            <Right>
              <Dependency path="/edcAgiThresholdMFS"/>
            </Right>
          </LessThan>
          <!-- TODO: check for nontaxable income below corresponding threshold-->
        </All>
      </Derived>
    </Fact>
    <Fact path="/isEligbleForEdcSingle">
      <Derived>
        <All>
          <Any>
            <Dependency path="/isFilingStatusSingle"/>
            <Dependency path="/isFilingStatusHOH"/>
            <Dependency path="/isFilingStatusQSS"/>
          </Any>
          <LessThan>
            <Left>
              <Dependency path="/agi"/>
            </Left>
            <Right>
              <Dependency path="/edcAgiThresholdSingle"/>
            </Right>
          </LessThan>
          <!-- TODO: check for nontaxable income below corresponding threshold-->
        </All>
      </Derived>
    </Fact>
    <Fact path="/edcAgiThresholdSingle">
      <Description>EDC AGI limit for single, head of household, or qualifying surviving spouse filers</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>17500</Dollar>
      </Derived>
    </Fact>
    <Fact path="/edcAgiThresholdMFJ">
      <Description>EDC AGI limit for MFJ filers</Description>
      <Derived>
        <Switch>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/numberOfEdcQualifyingTaxpayers"/>
                </Left>
                <Right>
                  <Int>2</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/edcAgiThresholdMFJBothQualified"/>
            </Then>
          </Case>
          <Case>
            <When>
              <Equal>
                <Left>
                  <Dependency path="/numberOfEdcQualifyingTaxpayers"/>
                </Left>
                <Right>
                  <Int>1</Int>
                </Right>
              </Equal>
            </When>
            <Then>
              <Dependency path="/edcAgiThresholdMFJOneQualified"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
    <Fact path="/edcAgiThresholdMFJBothQualified">
      <Description>EDC AGI limit for MFJ filers when both are qualified</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>25000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/edcAgiThresholdMFJOneQualified">
      <Description>EDC AGI limit for MFJ filers when one is qualified</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>20000</Dollar>
      </Derived>
    </Fact>
    <Fact path="/edcAgiThresholdMFS">
      <Description>EDC AGI limit for MFS filers</Description>
      <TaxYear>2026</TaxYear>
      <Derived>
        <Dollar>12500</Dollar>
      </Derived>
    </Fact>
    <Fact path="/elderlyAndDisabledTaxCreditAmount">
      <Description>Elderly and Disabled tax credit, no logic in place for actually calculating the
        applicable amount.</Description>
      <Writable>
        <Dollar/>
      </Writable>
      <Placeholder>
        <Dollar>0</Dollar>
      </Placeholder>
    </Fact>
    <Fact path="/totalEdc">
      <Derived>
        <Switch>
          <Case>
            <When>
              <Dependency path="/isEligibleForEdc"/>
            </When>
            <Then>
              <!--        TODO: update this with correct derivation logic-->
              <Dependency path="/elderlyAndDisabledTaxCreditAmount"/>
            </Then>
          </Case>
          <Case>
            <When>
              <True/>
            </When>
            <Then>
              <Dollar>0</Dollar>
            </Then>
          </Case>
        </Switch>
      </Derived>
    </Fact>
  </Facts>
</FactDictionaryModule>
