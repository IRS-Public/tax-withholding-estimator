<?xml version="1.0"?>
<?xml-model href="./FlowConfig.rng"?>
<FlowConfig>
  <page title="Results" route="/results">
    <section>
      <h2>Your withholding results</h2>

      <p condition="/isOverwithheld" operator="isTrue">Based on what you entered, we estimate that <strong>you're withholding more taxes than you need to.</strong></p>
      <p condition="/isOverwithheld" operator="isTrue">If you keep your withholding the same, you'll likely get a federal tax refund in <fg-show path="/taxYear"/></p>
      <p condition="/isOverwithheld" operator="isTrue">If you'd like to get more take-home pay, you can <a class="usa-link" href="#heading-adjust-withholding-for-more-take-home-pay">adjust your withholding</a>.</p>

      <p condition="/isUnderwithheld" operator="isTrue">Based on what you entered, we estimate that <strong>you're not withholding enough taxes.</strong></p>
      <p condition="/isUnderwithheld" operator="isTrue">
        If you keep your withholding the same, you’ll likely owe taxes in <fg-show path="/taxYear"/>.
        <span condition="/mayBeSubjectToUnderpaymentPenalty" operator="isTrue">
          You may have to pay a penalty in addition to what you owe if you owe
          <span condition="/underpaymentPenaltyReasonIs1000DollarLimit" operator="isTrue">at least $1,000.</span>
          <span condition="/underpaymentPenaltyReasonIs10PercentLimit" operator="isTrue">more than 10 percent of your tax bill.</span>
        </span>
      </p>

      <p condition="/isUnderwithheld" operator="isTrue">
        If you’d like to get your tax balance closer to $0
        <span condition="/mayBeSubjectToUnderpaymentPenalty" operator="isTrue">and avoid paying a penalty</span>,
        you can <a class="usa-link" href="#heading-adjust-withholding-for-lower-tax-balance">adjust your withholding</a>.
        <!-- TODO: There is also an "underwithheld and can't make up" scenario that adds some content here-->
      </p>

      <p condition="/isZeroRefund" operator="isTrue">Based on what you entered, we estimate that <strong>you’re withholding enough to cover your federal taxes.</strong></p>
      <p condition="/isZeroRefund" operator="isTrue">If you keep your withholding the same, it’s likely you won’t owe federal taxes in <fg-show path="/taxYear"/>.</p>
      <p condition="/isZeroRefund" operator="isTrue">If you <a class="usa-link" href="#heading-adjust-withholding">adjust your withholding</a>, your federal tax balance and take-home pay will change.</p>

      <div class="fg-estimate">
        <h3 class="fg-estimate__heading" condition="/isOverwithheld" operator="isTrue">Estimated federal tax refund</h3>
        <h3 class="fg-estimate__heading" condition="/isOverwithheld" operator="isFalse">Estimated federal tax owed</h3>
        <p class="fg-estimate__amount fg-estimate__amount-under-withheld" condition="/isUnderwithheld" operator="isTrue">$<fg-show path="/totalOwed"/></p>
        <p class="fg-estimate__amount" condition="/isUnderwithheld" operator="isFalse">$<fg-show path="/totalRefund"/></p>
      </div>
      <details class="fg-estimate__details">
        <summary>
          <h4>Your calculation</h4>
        </summary>
        <div class="usa-prose">
          <p>First, we calculated your taxable income.</p>
          <table class="usa-table usa-table--borderless width-full">
            <caption class="usa-sr-only">Taxable income breakdown</caption>
            <thead class="usa-sr-only">
              <tr>
                <th scope="col">Description</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Gross income</th>
                <td>$<fg-show path="/incomeTotal"/></td>
              </tr>
              <tr condition="/adjustmentsToIncome" operator="isGreaterThanZero">
                <th scope="row">Adjustments</th>
                <td>-$<fg-show path="/adjustmentsToIncome"/></td>
              </tr>
              <tr>
                <th scope="row">
                  <span condition="/standardDeductionWillBeUsed" operator="isTrue">Standard Deduction</span>
                  <span condition="/standardDeductionWillBeUsed" operator="isFalse">Itemized Deduction</span>
                </th>
                <td>-$<fg-show path="/standardOrItemizedDeduction"/></td>
              </tr>
              <tr condition="/additionalDeductions" operator="isGreaterThanZero">
                <th scope="row">Additional Deductions</th>
                <td>-$<fg-show path="/additionalDeductions"/></td>
              </tr>
              <tr>
                <th scope="row">Taxable income</th>
                <td>$<fg-show path="/taxableIncome"/></td>
              </tr>
            </tbody>
          </table>

          <p>Then, we applied your federal tax bracket to your taxable income to calculate your taxes.</p>
          <table class="usa-table usa-table--borderless width-full">
            <caption class="usa-sr-only">Federal tax obligation breakdown</caption>
            <thead class="usa-sr-only">
              <tr>
                <th scope="col">Description</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Federal tax obligation</th>
                <td>$<fg-show path="/totalTaxObligationBeforeCreditsAndDeductions"/></td>
              </tr>
            </tbody>
          </table>

          <p>Finally, we applied your credits and subtracted any payments you already made towards your federal taxes.</p>
          <table class="usa-table usa-table--borderless width-full">
            <caption class="usa-sr-only">Federal tax balance breakdown</caption>
            <thead class="usa-sr-only">
              <tr>
                <th scope="col">Description</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr condition="/totalCredits" operator="isGreaterThanZero">
                <th scope="row">Credits</th>
                <td>-$<fg-show path="/totalCredits"/></td>
              </tr>
              <tr>
                <th scope="row">Federal tax withholding</th>
                <td>-$<fg-show path="/totalEndOfYearProjectedWithholding"/></td>
              </tr>
              <tr condition="/totalEstimatedTaxesPaid" operator="isGreaterThanZero">
                <th scope="row">Estimated tax payments</th>
                <td>-$<fg-show path="/totalEstimatedTaxesPaid"/></td>
              </tr>
              <tr>
                <th scope="row">
                  <span condition="/isUnderwithheld" operator="isTrue">Estimated federal tax owed</span>
                  <span condition="/isUnderwithheld" operator="isFalse">Estimated federal tax refund</span>
                </th>
                <td>
                  <!-- TODO: /totalOwed does not account for projected withholdings, so this is incorrect for W4 and W4P income -->
                  <span condition="/isUnderwithheld" operator="isTrue">$<fg-show path="/totalOwed"/></span>
                  <span condition="/isUnderwithheld" operator="isFalse">$<fg-show path="/totalRefund"/></span>
                </td>
              </tr>
            </tbody>
          </table>

          <p class="fg-estimate__disclaimer">Note: The IRS does not guarantee the accuracy of this estimate and accepts no liability resulting from your use of this estimation.</p>
        </div>
      </details>

      <h3 id="heading-adjust-withholding-for-more-take-home-pay" condition="/isOverwithheld" operator="isTrue">How to adjust your withholding to get more take-home pay</h3>
      <h3 id="heading-adjust-withholding-for-lower-tax-balance" condition="/isUnderwithheld" operator="isTrue">How to adjust your withholding to get more take-home pay</h3>
      <h3 id="heading-adjust-withholding" condition="/isZeroRefund" operator="isTrue">How to adjust your withholding</h3>

      <p condition="/hasJobsIncomeButNoPensionsIncome" operator="isTrue">Use our recommendations to complete Form W-4.</p>
      <p condition="/hasJobsIncomeButNoPensionsIncome" operator="isTrue"><modal-link for="modal-what-is-form-w-4">What's a Form W-4?</modal-link></p>

      <p condition="/hasPensionsIncomeButNoJobsIncome" operator="isTrue">Use our recommendations to complete Form W-4P.</p>
      <p condition="/hasPensionsIncomeButNoJobsIncome" operator="isTrue"><modal-link for="modal-what-is-form-w-4p">What's a Form W-4P?</modal-link></p>

      <p condition="/hasJobsIncomeAndPensionsIncome" operator="isTrue">Use our recommendations to complete Forms W-4 and W-4P.</p>
      <p condition="/hasJobsIncomeAndPensionsIncome" operator="isTrue"><modal-link for="modal-what-is-form-w-4-and-w-4p">What's a Form W-4 and W-4P?</modal-link></p>

      <!-- TODO: for each job / pension show w-4/w-4p section -->
      <!-- TODO: Button goes inside accordion for each job -->
      <!--<button class="usa-button usa-button&#45;&#45;outline" type="button" onclick="downloadW4(window.factGraph)">Download pre-filled Form W4</button>-->
      <!-- /TODO -->

      <div class="usa-alert usa-alert--info">
        <div class="usa-alert__body">
          <h4 class="usa-alert__heading">Check your withholding every January</h4>
          <p class="usa-alert__text">This will help you decide if you need to make any adjustments for the year.</p>
        </div>
      </div>
    </section>
    <modal-dialog id="modal-what-is-form-w-4">
      <modal-heading>What’s a Form W-4?</modal-heading>
      <modal-content>
        <p>You need to submit a Form W-4 to each of your employers to help them withhold the right amount of taxes from your paychecks throughout the year.</p>
        <p>Withholding at the right rate ensures that you don’t withhold too much and get smaller paychecks, or withhold too little and end up owing a large amount, or even penalties, at the end of the year.</p>
        <p><a target="_blank" class="usa-link" href="https://www.irs.gov/forms-pubs/about-form-w-4">Learn more about Form W-4.</a></p>
      </modal-content>
    </modal-dialog>
    <modal-dialog id="modal-what-is-form-w-4p">
      <modal-heading>What’s a Form W-4P?</modal-heading>
      <modal-content>
        <p>You need to submit a Form W-4P to your pension or annuity providers to help them withhold the right amount of taxes from your payments throughout the year.</p>
        <p>Withholding at the right rate ensures that you don’t withhold too much and get smaller payments, or withhold too little and end up owing a large amount, or even penalties, at the end of the year.</p>
        <p><a target="_blank" class="usa-link" href="https://www.irs.gov/forms-pubs/about-form-w-4-p">Learn more about Form W-4P.</a></p>
      </modal-content>
    </modal-dialog>
    <modal-dialog id="modal-what-is-form-w-4-and-w-4p">
      <modal-heading>What’s a Form W-4 and W-4P?</modal-heading>
      <modal-content>
        <p>You need to submit a Form W-4 to each of your employers or a Form W-4P to your pension or annuity providers to help them withhold the right amount of taxes from your paycheck or pension payment throughout the year.</p>
        <p>Withholding at the right rate ensures that you don’t withhold too much and take home a smaller amount, or withhold too little and end up owing a large amount, or even penalties, at the end of the year.</p>
        <p><a target="_blank" class="usa-link" href="https://www.irs.gov/forms-pubs/about-form-w-4">Learn more about Form W-4.</a></p>
        <p><a target="_blank" class="usa-link" href="https://www.irs.gov/forms-pubs/about-form-w-4-p">Learn more about Form W-4P.</a></p>
      </modal-content>
    </modal-dialog>
  </page>
</FlowConfig>
