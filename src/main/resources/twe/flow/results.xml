<?xml version="1.0"?>
<?xml-model href="./FlowConfig.rng"?>
<FlowConfig>
  <page title="Results" route="/results">
    <section>
      <h2>Your withholding results</h2>

      <p condition="/isOverwithheld" operator="isTrue">Based on what you entered, we estimate that <strong>you're withholding more taxes than you need to.</strong></p>
      <p condition="/isOverwithheld" operator="isTrue">If you keep your withholding the same, you'll likely get a federal tax refund in <fg-show path="/taxYear"/></p>
      <p condition="/isOverwithheld" operator="isTrue">If you'd like to get more take-home pay, you can <a class="usa-link" href="#heading-adjust-withholding-for-more-take-home-pay">adjust your withholding</a>.</p>

      <p condition="/isUnderwithheld" operator="isTrue">Based on what you entered, we estimate that <strong>you're not withholding enough taxes.</strong></p>
      <p condition="/isUnderwithheld" operator="isTrue">
        If you keep your withholding the same, you’ll likely owe taxes in <fg-show path="/taxYear"/>.
        {{You may have to pay a penalty in addition to what you owe if you owe [at least $1,000/more than 10 percent of your tax bill].}}
      </p>
        <!-- TODO: There is also an "underwithheld and can't make up" scenario that adds some content here-->
      <p condition="/isUnderwithheld" operator="isTrue">If you’d like to get your tax balance closer to $0 {{and avoid paying a penalty}}, you can <a class="usa-link" href="#heading-adjust-withholding-for-lower-tax-balance">adjust your withholding</a>.</p>

      <p condition="/isZeroRefund" operator="isTrue">Based on what you entered, we estimate that <strong>you’re withholding enough to cover your federal taxes.</strong></p>
      <p condition="/isZeroRefund" operator="isTrue">If you keep your withholding the same, it’s likely you won’t owe federal taxes in <fg-show path="/taxYear"/>.</p>
      <p condition="/isZeroRefund" operator="isTrue">If you <a class="usa-link" href="#heading-adjust-withholding">adjust your withholding</a>, your federal tax balance and take-home pay will change.</p>

      <div class="fg-estimate">
        <h3 class="fg-estimate__heading" condition="/isOverwithheld" operator="isTrue">Estimated federal tax refund</h3>
        <h3 class="fg-estimate__heading" condition="/isOverwithheld" operator="isFalse">Estimated federal tax owed</h3>
        <p class="fg-estimate__amount fg-estimate__amount-under-withheld" condition="/isUnderwithheld" operator="isTrue">$<fg-show path="/totalOwed"/></p>
        <p class="fg-estimate__amount" condition="/isUnderwithheld" operator="isFalse">$<fg-show path="/totalRefund"/></p>
      </div>
      <details class="fg-estimate__details">
        <summary>
          <h4>Your calculation</h4>
        </summary>
        <div class="usa-prose">
          <p>First, we calculated your taxable income.</p>
          <table class="usa-table usa-table--borderless width-full">
            <caption class="usa-sr-only">Taxable income breakdown</caption>
            <thead class="usa-sr-only">
              <tr>
                <th scope="col">Description</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Gross income</th>
                <td>$<fg-show path="/incomeTotal"/></td>
              </tr>
              <tr condition="/adjustmentsToIncome" operator="isGreaterThanZero">
                <th scope="row">Adjustments</th>
                <td>-$<fg-show path="/adjustmentsToIncome"/></td>
              </tr>
              <tr>
                <th scope="row">
                  <span condition="/standardDeductionWillBeUsed" operator="isTrue">Standard Deduction</span>
                  <span condition="/standardDeductionWillBeUsed" operator="isFalse">Itemized Deduction</span>
                </th>
                <td>-$<fg-show path="/standardOrItemizedDeduction"/></td>
              </tr>
              <tr condition="/additionalDeductions" operator="isGreaterThanZero">
                <th scope="row">Additional Deductions</th>
                <td>-$<fg-show path="/additionalDeductions"/></td>
              </tr>
              <tr>
                <th scope="row">Taxable income</th>
                <td>$<fg-show path="/taxableIncome"/></td>
              </tr>
            </tbody>
          </table>

          <p>Then, we applied your federal tax bracket to your taxable income to calculate your taxes.</p>
          <table class="usa-table usa-table--borderless width-full">
            <caption class="usa-sr-only">Federal tax obligation breakdown</caption>
            <thead class="usa-sr-only">
              <tr>
                <th scope="col">Description</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">Federal tax obligation</th>
                <td>$<fg-show path="/totalTaxObligationBeforeCreditsAndDeductions"/></td>
              </tr>
            </tbody>
          </table>

          <p>Finally, we applied your credits and subtracted any payments you already made towards your federal taxes.</p>
          <table class="usa-table usa-table--borderless width-full">
            <caption class="usa-sr-only">Federal tax balance breakdown</caption>
            <thead class="usa-sr-only">
              <tr>
                <th scope="col">Description</th>
                <th scope="col">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr condition="/totalCredits" operator="isGreaterThanZero">
                <th scope="row">Credits</th>
                <td>-$<fg-show path="/totalCredits"/></td>
              </tr>
              <tr>
                <th scope="row">Federal tax withholding</th>
                <td>-$<fg-show path="/totalEndOfYearProjectedWithholding"/></td>
              </tr>
              <tr condition="/totalEstimatedTaxesPaid" operator="isGreaterThanZero">
                <th scope="row">Estimated tax payments</th>
                <td>-$<fg-show path="/totalEstimatedTaxesPaid"/></td>
              </tr>
              <tr>
                <th scope="row">
                  <span condition="/isUnderwithheld" operator="isTrue">Estimated federal tax owed</span>
                  <span condition="/isUnderwithheld" operator="isFalse">Estimated federal tax refund</span>
                </th>
                <td>
                  <span condition="/isUnderwithheld" operator="isTrue">$<fg-show path="/totalOwed"/></span>
                  <span condition="/isUnderwithheld" operator="isFalse">$<fg-show path="/totalRefund"/></span>
                </td>
              </tr>
            </tbody>
          </table>

          <p class="fg-estimate__disclaimer">Note: The IRS does not guarantee the accuracy of this estimate and accepts no liability resulting from your use of this estimation.</p>
        </div>
      </details>

      <h3 id="heading-adjust-withholding-for-more-take-home-pay" condition="/isOverwithheld" operator="isTrue">How to adjust your withholding to get more take-home pay</h3>
      <h3 id="heading-adjust-withholding-for-lower-tax-balance" condition="/isUnderwithheld" operator="isTrue">How to adjust your withholding to get more take-home pay</h3>
      <h3 id="heading-adjust-withholding" condition="/isZeroRefund" operator="isTrue">How to adjust your withholding</h3>

      <!-- TODO: Remove old content -->
      <hr/>
      <p>TODO: OLD CONTENT BELOW</p>
      <hr/>

      <h2>Results</h2>
      <table class="usa-table width-full usa-table--borderless usa-table--flush">
        <caption>Income and taxes</caption>
        <thead>
          <tr>
            <th scope="col">Description</th>
            <th scope="col">Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">Adjusted gross income</th>
            <td>
              <fg-show path="/agi"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Standard deduction</th>
            <td>
              <fg-show path="/standardDeduction"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Taxable income</th>
            <td>
              <fg-show path="/taxableIncome"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Tentative Tax from Taxable Income:</th>
            <td>
              <fg-show path="/tentativeTaxFromTaxableIncome"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Total taxes owed:</th>
            <td>
              <fg-show path="/totalOwed"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Total year-to-date jobs withholding</th>
            <td>
              <fg-show path="/totalYearToDateJobsWithholding"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Gap in withholding for the rest of the year</th>
            <td>
              <fg-show path="/withholdingGap"/>
            </td>
          </tr>
        </tbody>
      </table>
      <table class="usa-table width-full usa-table--borderless usa-table--flush">
        <caption>New Forms W-4 information</caption>
        <thead>
          <tr>
            <th scope="col">Description</th>
            <th scope="col">Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th scope="row">Line 1 filing status</th>
            <td>
              <fg-show path="/filingStatus"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Line 2(c) checkbox</th>
            <td>false</td>
          </tr>
          <tr>
            <th scope="row">Line 3 total credits</th>
            <td>
              <fg-show path="/totalCredits"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Line 4(a) other income (not from jobs)</th>
            <td>
              <fg-show path="/jobs/*/w4Line4a"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Line 4(b) deductions</th>
            <td>
              <fg-show path="/jobs/*/w4Line4b"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Line 4(c) extra withholding</th>
            <td>
              <fg-show path="/jobs/*/w4Line4c"/>
            </td>
          </tr>
          <tr>
            <th scope="row">Remaining pay periods</th>
            <td>
              <fg-show path="/jobs/*/remainingPayPeriodsInteger"/>
            </td>
          </tr>
        </tbody>
      </table>
      <button class="usa-button usa-button--outline" type="button" onclick="downloadW4(window.factGraph)">Download pre-filled Form W4</button>
    </section>
  </page>
</FlowConfig>
